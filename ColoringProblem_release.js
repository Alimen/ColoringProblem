var ai=function(){function v(a){var d=[],n=0,c,b,m=[];for(c=0;c<a.length;c++){var g=a[c];b=Math.floor(g/10);var g=g%10,H=0,l=void 0;if(-1!=f(b)||0==k(b,g))b=0;else{l=r[p[b][0]];h(b,g);for(i=0;i<x[b].length;i++)-1==f(x[b][i])&&1==e(x[b][i])&&H++;h(b,l);b=H+1}m.push(b);0<b&&w.length%2==b%2&&d.push(a[c])}if(0<d.length){a.length=d.length;for(c=0;c<d.length;c++)a[c]=d[c];0==w.length%2&&(n=1)}return n}function q(a,d){for(var n=0;n<d.length;n++)if(1==l(a,d[n]))return 1;return 0}function l(a,d){for(var n=
0;n<a.length;n++)if(1==c(a[n],d))return 1;return 0}function c(a,d){var n;n=1==Math.floor(a/18)%2?1:-1;return a+1==d||a-1==d||a-18==d||a-18+n==d||a+18==d||a+18+n==d?1:0}function g(c){var d,n,b,e;b=a(c);d=b[0];var k=b[1],m=b[2],f=b[3],g=Array(216);for(b=0;d<=m;d++)for(e=18*d,n=Math.floor(f);n<=Math.floor(k);n++)g[b]=r[e+n]==c?r[e+n]:" ",b++;return g}function a(a){var d,n,c,b=-1,e=-1,k=-1,m=-1;for(d=0;12>d;d++){c=18*d;for(n=0;18>n;n++)if(a==r[c+n]){b=d;break}if(-1<b)break}for(;12>d;d++){c=18*d;for(n=
0;18>n;n++)if(a==r[c+n]){e=d;break}if(e<d)break}for(d=0;36>d;d++){for(n=d%2?18+(d-1)/2:d/2;216>n;n+=36)if(a==r[n]){k=d/2;break}if(-1<k)break}for(d=35;0<=d;d--){for(n=d%2?18+(d-1)/2:d/2;216>n;n+=36)if(a==r[n]){m=d/2;break}if(-1<m)break}return[b,m,e,k]}function f(a){return 3<r[p[a][0]]||0>r[p[a][0]]?-1:r[p[a][0]]}function b(a,d){h(a,d);w.splice(w.indexOf(a),1)}function h(a,d){for(var n=0;n<p[a].length;n++)r[p[a][n]]=d}function k(a,d){var n;for(n=0;n<x[a].length;n++)if(r[p[x[a][n]][0]]==d)return 0;return 1}
function e(a){return 0==k(a,1)&&0==k(a,2)&&0==k(a,3)?1:0}function m(){var a,d=[];for(a=0;a<w.length;a++)1==e(w[a])&&d.push(w[a]);return d}function u(a){for(var d,n,c,b=0;b<a.length;b++)d=Math.random(),d*=a.length,d=Math.floor(d),n=Math.random(),n*=a.length,n=Math.floor(n),c=a[d],a[d]=a[n],a[n]=c}var r=Array(216),p=[],x=[],E=[],D=[],w=[],A,B,y=100;return{setAIability:function(a){y=a},aiPick:function(){var a=[],d,c;for(d=0;d<w.length;d++)for(c=1;3>=c;c++)1==k(w[d],c)&&a.push(10*w[d]+c);c=a.slice(0);
console.log("candidates = ",a);v(a,w.length);console.log("candidates after defensivePick() = ",a);d=a;var e=[],f=[],g=[],h,p,l,B=r.slice(0),u=w.slice(0);for(p=0;p<d.length;p++){h=Math.floor(d[p]/10);l=d[p]%10;b(h,l);m();for(l=e.length=0;l<w.length;l++)for(h=1;3>=h;h++)1==k(w[l],h)&&e.push(10*w[l]+h);h=v(e);0==h?f.push(-1):f.push(e.length);r=B.slice(0);w=u.slice(0)}e=0;g.push(d[0]);for(h=1;h<f.length;h++)f[h]==f[e]?g.push(d[h]):f[h]<f[e]&&(e=h,g.length=0,g.push(d[h]));if(0<g.length)for(d.length=g.length,
h=0;h<g.length;h++)d[h]=g[h];console.log("candidates after offensivePick() = ",a);if(.5>Math.random()){d=a;if(!(1>=d.length)){g=Math.floor(d[0]/10);e=[];e.push(d[0]);for(p=1;p<d.length;p++)f=Math.floor(d[p]/10),x[f].length>x[g].length?(g=f,e.length=0,e.push(d[p])):x[f].length==x[g].length&&e.push(d[p]);if(0<e.length)for(d.length=e.length,p=0;p<e.length;p++)d[p]=e[p]}console.log("candidates after monopolyPick() = ",a)}if(100*Math.random()>=y){f=[];for(d=0;d<c.length;d++)-1==a.indexOf(c[d])&&f.push(c[d]);
0<f.length&&(a=f);console.log("candidates after inverse = ",a)}return a[Math.floor(Math.random()*a.length)]},presetBoard:function(c,d,e,b){r=d.slice(0);A=e;B=b;p.length=c;x.length=c;for(d=0;d<c;d++)p[d]=[],x[d]=[];for(d=0;216>d;d++)61<=r[d]&&p[r[d]-61].push(d);for(d=0;d<c-1;d++)for(e=d+1;e<c;e+=1)1==q(p[d],p[e])&&(x[d].push(e),x[e].push(d));E.length=0;for(d=D.length=0;d<c;d++)E.push(g(d+61)),D.push(a(d+61));for(d=w.length=0;d<c;d++)w.push(d)},setupBoard:function(e,d,b){25<e&&(e=25);A=6<d?6:d;B=3<
b?3:b;d=[];var f=Array(216),k,h;for(b=d.length=0;216>b;b++)1==(b<18*B||b>=18*(12-B)||b%18<A||b%18>=18-A||1==Math.floor(b/18)%2&&b%18==18-A-1?1:0)?r[b]=" ":(r[b]="0",d.push(b));p.length=e;x.length=e;for(b=0;b<e;b++)p[b]=[],x[b]=[];var m=[];for(b=0;5>b;){h=d[Math.floor(Math.random()*d.length)];for(k=f=0;k<m.length;k++)if(1==c(h,m[k])||h==m[k]){f=1;break}0==f&&(m.push(h),r[h]=" ",d.splice(d.indexOf(h),1),b++)}f=d.slice(0);u(f);for(b=0;b<e;b++)r[f[b]]=b+61,p[b].push(f[b]),d.splice(d.indexOf(f[b]),1);
for(;0<d.length;)for(k=d.length,f=d.slice(0),u(f),b=0;b<k;b++){h=f[b];for(var m=[],H=void 0,y=void 0,H=0;H<p.length;H++)1==l(p[H],h)&&m.push(H);if(1>m.length)h=-1;else if(1==m.length)h=m[0];else{y=0;for(H=1;H<m.length;H++)p[H].length<p[y].length&&(y=H);h=m[y]}0<=h&&(r[f[b]]=h+61,p[h].push(f[b]),d.splice(d.indexOf(f[b]),1))}for(b=0;b<e-1;b++)for(k=b+1;k<e;k+=1)1==q(p[b],p[k])&&(x[b].push(k),x[k].push(b));E.length=0;for(b=D.length=0;b<e;b++)E.push(g(b+61)),D.push(a(b+61));for(b=w.length=0;b<e;b++)w.push(b)},
findGroup:function(a){var d;for(d=0;d<p.length;d++)if(-1!=p[d].indexOf(a))return d;return-1},getMaxRow:function(){return 12},getMaxCol:function(){return 18},getBoard:function(){return r},getGraphSize:function(){return x.length},getColor:f,setColor:b,isColorOK:k,getSubGraph:function(a){return E[a]},getBorder:function(a){return D[a]},getBlackout:m,getUncoloredCount:function(){return w.length}}}(),coloringProblem=function(){function v(){var f;switch(K){case I.initial:b="http://alimen.github.io/ColoringProblem/";
u.src=b+"image/Tiles.png";u.onload=c;r.src=b+"image/TileBorder.png";r.onload=c;h=document.getElementById("canvas");k=h.getContext("2d");e=document.createElement("canvas");e.width=h.width;e.height=h.height;m=e.getContext("2d");h.addEventListener("mousemove",q,!0);h.addEventListener("click",l,!0);X=1;K=I.preloading;break;case I.preloading:f=Math.round(U/V*100);k.fillStyle="#FFFFFF";k.fillRect(0,0,800,480);k.textBaseline="bottom";k.fillStyle="#000000";k.font="14px monospace";k.textAlign="center";k.fillText(f+
"%",400,240);break;case I.initLoader:N=document.createElement("audio");document.body.appendChild(N);f=N;var v="";if("probably"==f.canPlayType("audio/ogg")||"maybe"==f.canPlayType("audio/ogg"))v=".ogg";else if("probably"==f.canPlayType("audio/mp3")||"maybe"==f.canPlayType("audio/mp3"))v=".mp3";f=v;N.setAttribute("src",b+"sound/Result0"+f);N.addEventListener("canplaythrough",g,!1);L=document.createElement("audio");document.body.appendChild(L);L.setAttribute("src",b+"sound/Result1"+f);L.addEventListener("canplaythrough",
g,!1);M=document.createElement("audio");document.body.appendChild(M);M.setAttribute("src",b+"sound/Result2"+f);M.addEventListener("canplaythrough",g,!1);p.src=b+"image/HTML5_Logo.png";p.onload=g;x.src=b+"image/Shadow.png";x.onload=g;E.src=b+"image/Glow.png";E.onload=g;D.src=b+"image/Panel.png";D.onload=g;w.src=b+"image/Bottons.png";w.onload=g;A.src=b+"image/Beam.png";A.onload=g;B.src=b+"image/Sparks.png";B.onload=g;y.src=b+"image/Arm1.png";y.onload=g;F.src=b+"image/Arm2.png";F.onload=g;d.src=b+"image/Dot.png";
d.onload=g;n.src=b+"image/Warpline.png";n.onload=g;C.src=b+"image/Halos.jpg";C.onload=g;G.src=b+"image/Misc.png";G.onload=g;z.src=b+"image/Dialog.jpg";z.onload=g;J.src=b+"image/Title.png";J.onload=g;H.src=b+"image/Numbers.png";H.onload=g;P.src=b+"image/HUD.png";P.onload=g;for(f=0;5>f;f++)O[f]=new Image,O[f].src=b+"image/Background"+f+".jpg",O[f].onload=g;loader.init(Q,{tiles:u,tileBorder:r},m);K=I.loading;break;case I.loading:loader.draw(Math.ceil(100*W/Z));a();break;case I.loadComplete:N.removeEventListener("canplaythrough",
g,!1);L.removeEventListener("canplaythrough",g,!1);M.removeEventListener("canplaythrough",g,!1);title.init(Q,{},m);gameLogic.init(Q,{},m);ui.init(Q,{tiles:u,tileBorder:r,backgrounds:O,shadow:x,glow:E,title:J,beams:A,sparks:B,misc:G,numbers:H},m);dialog.init(Q,{panel:D,glow:E,misc:G,dialog:z},{result0:N,result1:L,result2:M},m);panel.init(Q,{panel:D,bottons:w},m);arm1.init(Q,{arm1:y},m);arm2.init(Q,{arm2:F},m);hud.init(Q,{glow:E,misc:G,hud:P,title:J,dialog:z},m);warp.init(Q,{dot:d,warpLine:n,halo:C},
m);tutorial.init(Q,{},m);loader.resetLogoSliding({tiles:u,tileBorder:r,html5:p,background:O[0]});K=I.showLogo;break;case I.showLogo:f=loader.pushLogoSliding();loader.drawLogoSliding();a();f!=I.unknown&&(K=I.resetTitle);break;case I.resetTitle:title.reset();K=I.title;break;case I.title:T=title.push();title.draw();a();T[0]!=I.unknown&&(1==X?(X=0,tutorial.reset(),K=I.tutorial):(K=I.game,gameLogic.reset(T[1],T[2])));break;case I.tutorial:f=tutorial.push();tutorial.draw();a();f!=I.unknown&&(K=I.game,gameLogic.reset(T[1],
T[2]));break;case I.game:f=gameLogic.push(),gameLogic.draw(),a(),f!=I.unknown&&(K=f)}}function q(a){if(a.offsetX||0==a.offsetX)R=a.offsetX,S=a.offsetY;else if(a.layerX||0==a.layerX)R=a.layerX-h.offsetLeft,S=a.layerY-h.offsetTop;switch(K){case I.title:title.eventMouseMove(R,S);break;case I.tutorial:tutorial.eventMouseMove(R,S);break;case I.game:gameLogic.eventMouseMove(R,S)}}function l(a){switch(K){case I.title:title.eventMouseClick(a);break;case I.tutorial:tutorial.eventMouseClick(a);break;case I.game:gameLogic.eventMouseClick(a)}}
function c(a){U++;U==V&&(K=I.initLoader)}function g(a){W++;W==Z&&(K=I.loadComplete)}function a(){k.drawImage(e,0,0)}function f(){setInterval(v,1E3/30)}if(canvasSupport){var b,h,k,e,m,u=new Image,r=new Image,p=new Image,x=new Image,E=new Image,D=new Image,w=new Image,A=new Image,B=new Image,y=new Image,F=new Image,d=new Image,n=new Image,C=new Image,G=new Image,z=new Image,J=new Image,H=new Image,P=new Image,O=Array(5),N,L,M,I={unknown:-1,initial:0,preloading:1,initLoader:2,loading:3,loadComplete:4,
showLogo:5,resetTitle:6,title:7,tutorial:8,game:9},K=I.initial,T,R,S,V=2,U=0,Q={mainStates:I,screenWidth:800,screenHeight:480},X,Z=25,W=0;return{startMessageLoop:f}}}();function canvasSupport(){return!!document.createElement("testcanvas").getContext}function eventWindowLoaded(){coloringProblem.startMessageLoop()}window.addEventListener("load",eventWindowLoaded,!1);
var dialog=function(){function v(a,e){var f,g=F[0];for(f=0;f<F.length;f++)if(F[f][1]==a){g=F[f];break}d=g;G=C=n.none;P=H=J=-1;k.clearRect(0,0,h.width,h.height);k.drawImage(c.panel,0,0,10,10,0,0,10,10);k.drawImage(c.panel,90,0,10,10,d[4]-10,0,10,10);k.drawImage(c.panel,90,80,10,10,d[4]-10,d[5]-10,10,10);k.drawImage(c.panel,0,80,10,10,0,d[5]-10,10,10);k.drawImage(c.panel,0,10,10,70,0,10,10,d[5]-20);k.drawImage(c.panel,10,0,80,10,10,0,d[4]-20,10);k.drawImage(c.panel,90,10,10,70,d[4]-10,10,10,d[5]-20);
k.drawImage(c.panel,10,80,80,10,10,d[5]-10,d[4]-20,10);k.drawImage(c.panel,10,10,10,10,10,10,d[4]-20,d[5]-20);switch(d[0]){case y.p1Wins:k.drawImage(c.dialog,0,0,228,28,d[4]/2-114,20,228,28);k.drawImage(c.dialog,0,25,72,50,d[4]/2-126,50,72,50);k.drawImage(c.dialog,0,75,144,50,d[4]/2-126+108,50,144,50);C=n.title;G=n.view;z=n.next;break;case y.p2Wins:k.drawImage(c.dialog,0,0,228,28,d[4]/2-114,20,228,28);k.drawImage(c.dialog,72,25,72,50,d[4]/2-126,50,72,50);k.drawImage(c.dialog,0,75,144,50,d[4]/2-126+
108,50,144,50);C=n.title;G=n.view;z=n.next;break;case y.aiWins:k.drawImage(c.dialog,0,0,228,28,d[4]/2-114,20,228,28);k.drawImage(c.dialog,360,25,72,50,d[4]/2-126,50,72,50);k.drawImage(c.dialog,0,75,144,50,d[4]/2-126+108,50,144,50);C=n.title;G=n.view;z=n.replay;break;case y.playerWins:k.drawImage(c.dialog,0,0,228,28,d[4]/2-114,20,228,28);k.drawImage(c.dialog,144,25,216,50,d[4]/2-198,50,216,50);k.drawImage(c.dialog,0,75,144,50,d[4]/2-198+252,50,144,50);C=n.title;G=n.view;z=n.next;break;case y.quit:k.drawImage(c.dialog,
0,130,300,60,d[4]/2-150,15,300,60);C=n.title;G=n.replay;z=n.cancel;break;case y.level:f=100<=e?105:10<=e?70:35;k.drawImage(c.dialog,144,75,180,50,d[4]/2-(215+f)/2,30,180,50);ui.drawNumbers(k,e,d[4]/2-(215+f)/2+215,28,1);C=n.none;G=n.next;z=n.none;break;case y.tutorial1:k.drawImage(c.dialog,0,190,286,50,d[4]/2-143,30,286,50);C=n.skip;G=n.none;z=n.next;break;case y.tutorial2:k.drawImage(c.dialog,286,214,264,26,d[4]/2-132,17,264,26);z=G=C=n.none;break;case y.tutorial3:k.drawImage(c.dialog,0,240,264,
94,d[4]/2-132,15,264,94);z=G=C=n.none;break;case y.tutorial4:k.drawImage(c.dialog,380,240,170,54,d[4]/2-85,13,170,54);z=G=C=n.none;break;case y.tutorial5:k.drawImage(c.dialog,0,334,530,56,d[4]/2-265,15,530,56);C=n.none;G=n.next;z=n.none;break;case y.tutorial6:k.drawImage(c.dialog,270,294,280,40,d[4]/2-140,15,280,40),k.drawImage(c.dialog,442,25,108,50,d[4]/2-126,65,108,50),k.drawImage(c.dialog,0,75,108,50,d[4]/2-126+144,65,108,50),C=n.replay,G=n.none,z=n.next}E=(d[2]-m)/b;D=(d[3]-u)/b;w=(d[4]-r)/b;
A=(d[5]-p)/b}function q(){if(0!=hud.getSoundon()){switch(O){case 0:g.result0.currentTime=0;g.result0.play();break;case 1:g.result1.currentTime=0;g.result1.play();break;case 2:g.result2.currentTime=0,g.result2.play()}O=(O+1)%3}}var l,c,g,a,f,b,h,k,e,m,u,r,p,x,E,D,w,A,B,y={unknown:-1,p1Wins:1,p2Wins:2,aiWins:3,playerWins:4,quit:5,level:6,tutorial1:7,tutorial2:8,tutorial3:9,tutorial4:10,tutorial5:11,tutorial6:12},F=[[y.unknown,"unknown",400,240,20,20],[y.p1Wins,"p1Wins",400,240,450,200],[y.p2Wins,"p2Wins",
400,240,450,200],[y.aiWins,"aiWins",400,240,450,200],[y.playerWins,"playerWins",400,240,450,200],[y.quit,"quit",400,240,340,165],[y.level,"level",400,240,370,180],[y.tutorial1,"tutorial1",400,240,370,180],[y.tutorial2,"tutorial2",600,320,300,60],[y.tutorial3,"tutorial3",540,400,300,130],[y.tutorial4,"tutorial4",540,300,220,80],[y.tutorial5,"tutorial5",400,400,560,140],[y.tutorial6,"tutorial6",400,240,360,200]],d,n={none:-1,next:0,skip:80,soundon:160,soundoff:240,title:320,cancel:400,replay:480,view:560},
C,G,z,J,H,P,O=2;return{init:function(d,b,m,p){a=d;c=b;g=m;l=p;e=0;f=-1;h=document.createElement("canvas");h.width=a.screenWidth;h.height=a.screenHeight;k=h.getContext("2d")},popup:function(a,c){u=m=0;p=r=20;x=0;b=10;v(a,c);m=d[2];u=d[3];D=E=0;B=.5/b;e=1;f=0;d[0]>=y.p1Wins&&d[0]<=y.playerWins&&q()},close:function(){b=10;D=E=0;w=d[4]/b;A=d[5]/b;B=.5/b;e=3;f=0},transform:function(a,c){2==e&&(b=15,v(a,c),B=0,e=1,f=0,d[0]==y.tutorial6&&q())},minimize:function(){2==e&&(b=15,E=(765-d[2])/b,D=(17-d[3])/b,
w=(d[4]-20)/b,A=(d[5]-20)/b,B=.5/b,e=4,f=0)},restore:function(){5==e&&(b=15,E=(d[2]-765)/b,D=(d[3]-17)/b,w=(d[4]-20)/b,A=(d[5]-20)/b,B=.5/b,e=6,f=0)},push:function(){if(!(0>f)){var a;a=d[0]>y.tutorial1&&d[0]<y.tutorial6?1:2;switch(e){case 1:m+=E;u+=D;r+=w;p+=A;x+=B;f++;f==b&&(x=.5,e++);ui.setFocus(a,x);break;case 3:m-=E;u-=D;r-=w;p-=A;x-=B;f++;f==b&&(e=x=0,f=-1);ui.setFocus(a,x);break;case 4:m+=E;u+=D;r-=w;p-=A;x-=B;f++;f==b&&(x=0,e++,f=-1);ui.setFocus(a,x);break;case 6:m+=E,u+=D,r+=w,p+=A,x+=B,f++,
f==b&&(x=.5,e=2),ui.setFocus(a,x)}}},draw:function(){if(0!=e&&5!=e)if(1==e||3==e||4==e||6==e)l.drawImage(h,0,0,10,10,m-r/2,u-p/2,10,10),l.drawImage(h,d[4]-10,0,10,10,m+r/2-10,u-p/2,10,10),l.drawImage(h,d[4]-10,d[5]-10,10,10,m+r/2-10,u+p/2-10,10,10),l.drawImage(h,0,d[5]-10,10,10,m-r/2,u+p/2-10,10,10),0<p-20&&(l.drawImage(h,0,10,10,d[5]-20,m-r/2,u-p/2+10,10,p-20),l.drawImage(h,d[4]-10,10,10,d[5]-20,m+r/2-10,u-p/2+10,10,p-20)),0<r-20&&(l.drawImage(h,10,0,d[4]-20,10,m-r/2+10,u-p/2,r-20,10),l.drawImage(h,
10,d[5]-10,d[4]-20,10,m-r/2+10,u+p/2-10,r-20,10)),0<p-20&&0<r-20&&l.drawImage(c.panel,10,10,10,10,m-r/2+10,u-p/2+10,r-20,p-20);else if(l.drawImage(h,m-r/2,u-p/2),2==e){var a,b;C!=n.none&&(a=m-r/3-40,b=u-p/2+(p-64-10),0<=J&&l.drawImage(c.glow,80*J,0,80,86,a,b-20,80,86),l.drawImage(c.misc,C,0,80,64,a,b,80,64));G!=n.none&&(a=m-40,b=u-p/2+(p-64-10),0<=H&&l.drawImage(c.glow,80*H,0,80,86,a,b-20,80,86),l.drawImage(c.misc,G,0,80,64,a,b,80,64));z!=n.none&&(a=m+r/3-40,b=u-p/2+(p-64-10),0<=P&&l.drawImage(c.glow,
80*P,0,80,86,a,b-20,80,86),l.drawImage(c.misc,z,0,80,64,a,b,80,64))}},checkPassSlot1:function(a,d,b){return 2!=e?-1:J=a>m-r/2&&a<=m-r/6&&d>u-p/2+(p-64-10)&&d<u+p/2?b:-1},checkPassSlot2:function(a,d,b){return 2!=e?-1:H=a>m-r/6&&a<=m+r/6&&d>u-p/2+(p-64-10)&&d<u+p/2?b:-1},checkPassSlot3:function(a,d,b){return 2!=e?-1:P=a>m+r/6&&a<=m+r/2&&d>u-p/2+(p-64-10)&&d<u+p/2?b:-1}}}(),gameLogic=function(){function v(c,g){h=c;e=g;var l,q,v,w;1==h?(l=11>e?e+4:23>e?e+3:25,q=16>e?6-Math.floor((e-1)/3):1,v=17>e?3-Math.floor((e-
1)/8):1,w=13>e?-20+10*(e-1):100):(l=20,v=q=1,w=100);ai.setupBoard(l,q,v);ai.setAIability(w);hud.setInfo(h,e);1==e%2?(ui.resetSlideIn(2,1,2,m),k=0):(ui.resetSlideIn(1,2,2,m),k=1);m=0;f=a.animating;b=1==h?a.level:a.selecting;u=-1}function q(b,e){c=b;g=e;switch(f){case a.level:dialog.checkPassSlot2(b,e,0);break;case a.selecting:hud.checkMousePassSound(b,e,k);hud.checkMousePassTitle(b,e,k);0==k?arm1.setTarget(b,e):arm2.setTarget(b,e);u=ui.selection(b,e);ui.setSelect(u,k);break;case a.colorSelect:panel.select(b,
e);break;case a.resulting:dialog.checkPassSlot1(b,e,(k+1)%2);dialog.checkPassSlot2(b,e,(k+1)%2);dialog.checkPassSlot3(b,e,(k+1)%2);break;case a.viewing:hud.checkMousePassSound(b,e,(k+1)%2);hud.checkMousePassMinimized(b,e,(k+1)%2);break;case a.quit:dialog.checkPassSlot1(b,e,k),dialog.checkPassSlot2(b,e,k),dialog.checkPassSlot3(b,e,k)}}var l,c,g,a={unknown:-1,reset:0,level:1,animating:2,selecting:3,colorSelect:4,aiSelect:5,switching:6,resulting:7,viewing:8,quit:9,leaving:10},f,b,h,k,e,m,u;return{init:function(a,
b,e){l=a;c=l.screenWidth/2;g=l.screenHeight/2;m=0},reset:v,push:function(){ui.push();if(1==ui.isIdle()&&f==a.animating)switch(f=b,f){case a.reset:v(h,e+1);break;case a.level:dialog.popup("level",e);break;case a.selecting:q(c,g);break;case a.aiSelect:var m;m=ai.aiPick();ui.resetPaint(Math.floor(m/10),m%10,k);u=-1;ui.setSelect(-1,0);f=a.animating;b=a.switching;break;case a.switching:k=(k+1)%2;ui.resetSwitching(k);f=a.animating;b=0==ai.getUncoloredCount()?a.resulting:1==h&&1==k?a.aiSelect:a.selecting;
break;case a.resulting:2==h?1==k?dialog.popup("p1Wins"):dialog.popup("p2Wins"):1==k?dialog.popup("playerWins"):dialog.popup("aiWins")}return f==a.leaving?l.mainStates.resetTitle:l.mainStates.unknown},draw:function(){ui.draw()},eventMouseMove:q,eventMouseClick:function(l){switch(f){case a.level:0<=dialog.checkPassSlot2(c,g,0)&&(dialog.close(),f=a.animating,b=1==e%2?a.selecting:a.aiSelect);break;case a.selecting:0<=hud.checkMousePassSound(c,g,k)&&hud.setSoundon((hud.getSoundon()+1)%2);0<=hud.checkMousePassTitle(c,
g,k)&&(dialog.popup("quit"),f=a.quit,b=a.selecting);0<=u&&(panel.popup(c,g,u,[0,1,2]),f=a.colorSelect);break;case a.colorSelect:l=panel.select(c,g);-1==l?(panel.close(),f=a.selecting,u=ui.selection(c,g),ui.setSelect(u,k)):0<=l&&(panel.close(),ui.resetPaint(u,l+1,k),u=-1,ui.setSelect(-1,0),f=a.animating,b=a.switching);break;case a.resulting:if(0<=dialog.checkPassSlot1(c,g,k))dialog.close(),ui.resetSlideOut(2,0,1,0),f=a.animating,b=a.leaving;else if(0<=dialog.checkPassSlot2(c,g,k))dialog.checkPassSlot2(0,
0,0),dialog.minimize(),hud.setMinimized(1),b=f=a.viewing;else if(0<=dialog.checkPassSlot3(c,g,k)){dialog.close();var p;1==h&&0==k?(l=e,e--,p=1):(l=e+1,p=0);1==l%3&&0==p?(m=1,ui.resetSlideOut(0,0,0,1)):(m=0,1==l%2?ui.resetSlideOut(2,1,2,0):ui.resetSlideOut(1,2,2,0));f=a.animating;b=a.reset}break;case a.viewing:0<=hud.checkMousePassSound(c,g,(k+1)%2)&&hud.setSoundon((hud.getSoundon()+1)%2);0<=hud.checkMousePassMinimized(c,g,(k+1)%2)&&(dialog.restore(),hud.setMinimized(0),hud.checkMousePassMinimized(0,
0,0),f=a.resulting);break;case a.quit:0<=dialog.checkPassSlot1(c,g,k)?(dialog.close(),ui.resetSlideOut(2,0,1,0),hud.checkMousePassSound(c,g,k),hud.checkMousePassTitle(c,g,k),f=a.animating,b=a.leaving):0<=dialog.checkPassSlot2(c,g,k)?(dialog.close(),hud.checkMousePassSound(0,0,0),hud.checkMousePassTitle(0,0,0),e--,m=0,1==(e+1)%2?ui.resetSlideOut(2,1,2,0):ui.resetSlideOut(1,2,2,0),f=a.animating,b=a.reset):0<=dialog.checkPassSlot3(c,g,k)&&(dialog.close(),f=b)}}}}(),hud=function(){function v(){m=0;u=
2;p=r=0;mousePassMinimized=E=x=-1;g=-80;D=-160;k=-1;h=b=0}var q,l,c,g,a,f,b,h,k,e,m,u,r,p,x,E,D,w,A;return{init:function(a,b,e){c=a;l=b;q=e;v()},reset:v,resetSliding:function(c){2<c||0>c||c==b||(h=c,c=h-b,0<c?(f=.1,A=.2):(f=-.1,A=-.2,c*=-1),k=2==c?59:39,w=a=0,e=k)},push:function(){0>k||(k>e-20?(a+=f,w+=A):20>k&&(a-=f,w-=A),g+=a,D+=w,k--,0>k&&(b=h))},draw:function(){q.drawImage(l.hud,0,0,800,79,0,g,800,79);switch(u){case 0:q.drawImage(l.title,0,120,190,40,20,g+7,95,20);break;case 1:q.drawImage(l.title,
0,80,190,40,20,g+7,95,20);q.drawImage(l.title,260,120,190,40,490,g+7,95,20);ui.drawNumbers(q,r,560,g+7,.36);break;case 2:q.drawImage(l.title,260,80,216,40,20,g+7,108,20)}0==p?(0<=E&&q.drawImage(l.glow,80*E,0,80,86,745,g-7,40,43),q.drawImage(l.misc,320,0,80,64,745,g+3,40,32)):(0<=mousePassMinimized&&q.drawImage(l.glow,80*mousePassMinimized,0,80,86,745,g-7,40,43),q.drawImage(l.misc,560,0,80,64,745,g+3,40,32));0<=x&&q.drawImage(l.glow,80*x,0,80,86,760,g+30,40,43);1==m?q.drawImage(l.misc,160,0,80,64,
760,g+40,40,32):q.drawImage(l.misc,240,0,80,64,760,g+40,40,32);var a;a=9<ai.getUncoloredCount()?70:36;q.drawImage(l.hud,801,0,152,79,c.screenWidth/2-76,D,152,79);ui.drawNumbers(q,ai.getUncoloredCount(),c.screenWidth/2-a/2,D+3,1)},setSoundon:function(a){m=a},getSoundon:function(){return m},checkMousePassTitle:function(a,b,e){return E=745<a&&800>=a&&b>g-10&&b<=g+40?e:-1},checkMousePassSound:function(a,b,e){return x=760<a&&800>=a&&b>g+40&&b<=g+72?e:-1},checkMousePassMinimized:function(a,b,e){return mousePassMinimized=
745<a&&800>=a&&b>g-10&&b<=g+40?e:-1},setInfo:function(a,b){u=a;r=b},setMinimized:function(a){p=a}}}(),loader=function(){var v,q,l,c,g,a,f,b,h,k,e;return{init:function(a,b,e){l=a;q=b;v=e},draw:function(a){v.fillStyle="#cedfe7";v.fillRect(0,0,l.screenWidth,l.screenHeight);v.textBaseline="bottom";v.fillStyle="#000000";v.font="14px monospace";v.textAlign="center";v.fillText(a+"%",l.screenWidth/2,200);var b=Math.floor(a/10),e;e=30>a?1:60>a?2:3;for(var c=0;10>c;c++)c<b?v.drawImage(q.tiles,400,46*e,40,46,
200+40*c,240,40,46):c>b?v.drawImage(q.tiles,0,0,40,46,200+40*c,240,40,46):v.drawImage(q.tiles,40*(a-10*c),46*e,40,46,200+40*c,240,40,46),v.drawImage(q.tileBorder,40,0,40,46,200+40*c,240,40,46),v.drawImage(q.tileBorder,80,0,40,46,200+40*c,240,40,46);v.drawImage(q.tileBorder,0,0,40,46,560,240,40,46)},resetLogoSliding:function(m){q=m;a=0;f=1;h=0;k=h+l.screenWidth;e=k+l.screenWidth;b=0;g=c=59},pushLogoSliding:function(){switch(b){case 0:c>g-20?a+=f:20>c&&(a-=f);h-=a;k=h+l.screenWidth;e=k+l.screenWidth;
c--;0>c&&(b=1,c=9);break;case 1:c--;0>c&&(b=2,c=59);break;case 2:c>g-20?a+=f:20>c&&(a-=f),h-=a,k=h+l.screenWidth,e=k+l.screenWidth,c--,0>c&&(b=3,c=-1)}return 0>c&&3==b?l.mainStates.resetTitile:l.mainStates.unknown},drawLogoSliding:function(){v.fillStyle="#cedfe7";v.fillRect(0,0,l.screenWidth,l.screenHeight);v.textBaseline="bottom";v.fillStyle="#000000";v.font="14px monospace";v.textAlign="center";v.fillText("100%",l.screenWidth/2+h,200);color=3;for(var a=0;10>a;a++)v.drawImage(q.tiles,400,138,40,
46,200+40*a+h,240,40,46),v.drawImage(q.tileBorder,40,0,40,46,200+40*a+h,240,40,46),v.drawImage(q.tileBorder,80,0,40,46,200+40*a+h,240,40,46);v.drawImage(q.tileBorder,0,0,40,46,560+h,240,40,46);v.drawImage(q.html5,k+l.screenWidth/2-128,l.screenHeight/2-150);v.drawImage(q.background,e,0)}}}(),panel=function(){var v,q,l,c,g,a,f,b,h,k;return{init:function(a,k,g){q=k;v=g;l=0;c=-1;h=[0,1,2];f=document.createElement("canvas");f.width=100;f.height=90;b=f.getContext("2d")},popup:function(b,f,q,r){h=r.slice(0);
0==h[0]&&0==ai.isColorOK(q,1)&&(h[0]=3);1==h[1]&&0==ai.isColorOK(q,2)&&(h[1]=4);2==h[2]&&0==ai.isColorOK(q,3)&&(h[2]=5);k=-1;g=b;a=f-90;c=0;l=1},close:function(){l=3;c=4},push:function(){if(!(0>c))switch(l){case 1:c++;4==c&&l++;break;case 3:c--,0>c&&(l=0)}},draw:function(){if(0!=l){var e,m;b.drawImage(q.panel,0,0);0==k?b.drawImage(q.bottons,80,20*h[0],80,20,10,10,80,20):b.drawImage(q.bottons,0,20*h[0],80,20,10,10,80,20);1==k?b.drawImage(q.bottons,80,20*h[1],80,20,10,35,80,20):b.drawImage(q.bottons,
0,20*h[1],80,20,10,35,80,20);2==k?b.drawImage(q.bottons,80,20*h[2],80,20,10,60,80,20):b.drawImage(q.bottons,0,20*h[2],80,20,10,60,80,20);if(2==l)v.drawImage(f,g,a);else if(1==l||3==l)e=20*c,m=17.5*c,v.drawImage(f,0,80,10+e,10,g,a+90-10,10+e,10),v.drawImage(f,90,80,10,10,g+10+e,a+90-10,10,10),v.drawImage(f,0,0,10+e,10+m,g,a+90-20-m,10+e,10+m),v.drawImage(f,90,0,10,10+m,g+10+e,a+90-20-m,10,10+m)}},select:function(b,c){return 2!=l?-2:k=b>g&&b<g+100&&c>a&&c<=a+32&&3!=h[0]?0:b>g&&b<g+100&&c>a+32&&c<=a+
58&&4!=h[1]?1:b>g&&b<g+100&&c>a+58&&c<a+90&&5!=h[2]?2:-1},setBottonPress:function(a){k=a}}}(),arm1=function(){function v(){F=-220;A=a.screenWidth/2+F;B=a.screenHeight/2;D=A;w=B;y=0;z=-1;G=C=0;q(A,B)}function q(d,c){f=125+F;b=392;var g=Math.sqrt((d-f)*(d-f)+(c-b)*(c-b));u=f+.3*(d-f);r=b+.3*(c-b)-.2*(a.screenHeight-g);E=l(u,r,d,c);e=u-57*Math.cos(-1.02-E);m=r+57*Math.sin(-1.02-E);var g=l(f,b,e,m),n=Math.sqrt((e-f)*(e-f)+(m-b)*(m-b));p=g-Math.acos((15625+n*n-14641)/(250*n));h=f+125*Math.cos(p);k=b+125*
Math.sin(p);x=l(h,k,e,m)}function l(a,b,d,c){var e=Math.sqrt((d-a)*(d-a)+(c-b)*(c-b));b=Math.asin((c-b)/e);d<a&&(b=-1*b+Math.PI);return b}var c,g,a,f,b,h,k,e,m,u,r,p,x,E,D,w,A,B,y,F,d,n,C,G,z,J;return{init:function(b,d,e){a=b;g=d.arm1;c=e;v()},reset:v,resetSliding:function(a){if(!(2<a||0>a||a==C)){G=a;a=G-C;0<a?n=.2:(n=-.2,a*=-1);if(2==a)z=69;else switch(C){case 0:z=39;break;case 1:z=0>n?39:49;break;case 2:z=49}d=0;J=z}},push:function(){0<=z&&(z>J-20?d+=n:20>z&&(d-=n),F+=d,D=a.screenWidth/2+F,w=a.screenHeight/
2,z--,0>z&&(C=G));if(A==D&&B==w)y=0;else{if(15>=Math.sqrt((D-A)*(D-A)+(w-B)*(w-B)))A=D,B=w;else{var b=l(A,B,D,w);A+=15*Math.cos(b);B+=15*Math.sin(b)}y=1;q(A,B)}},draw:function(){c.drawImage(g,165,71,35,15,115+F,398,35,15);c.save();c.setTransform(1,0,0,1,0,0);c.translate(f,b);c.rotate(p+Math.PI+.12);c.drawImage(g,0,66,150,54,-132,-26,150,54);c.restore();c.save();c.setTransform(1,0,0,1,0,0);c.translate(e,m);c.rotate(E);c.drawImage(g,159,0,51,55,-20,0,51,55);c.restore();c.save();c.setTransform(1,0,0,
1,0,0);c.translate(h,k);c.rotate(x-.22);c.drawImage(g,0,0,158,65,-25,-25,158,65);c.restore();c.drawImage(g,0,121,171,110,0+F,370,171,110)},setTarget:function(a,b){D=a;w=b},getLaserHead:function(){return[u,r]},isMoving:function(){return y},isSliding:function(){return 0>z?0:1}}}(),arm2=function(){function v(){F=260;A=a.screenWidth/2+F;B=a.screenHeight/2;D=A;w=B;y=0;z=-1;G=C=0;q(A,B)}function q(d,c){f=696+F;b=383;var g=Math.sqrt(a.screenWidth*a.screenWidth+a.screenHeight*a.screenHeight),n=Math.sqrt((d-
f)*(d-f)+(c-b)*(c-b)),q=.5*(1-n/g)*Math.PI,M=l(f,b,d,c);p=M+q;h=f+117*Math.cos(p+.36);k=b+117*Math.sin(p+.36);x=M-q+Math.PI+(1-n/g);e=h+146*Math.cos(x+3.13);m=k+146*Math.sin(x+3.13);E=l(e,m,d,c)+Math.PI;u=e+23*Math.cos(E+3.15);r=m+23*Math.sin(E+3.15)}function l(a,b,d,c){var e=Math.sqrt((d-a)*(d-a)+(c-b)*(c-b));b=Math.asin((c-b)/e);d<a&&(b=-1*b+Math.PI);return b}var c,g,a,f,b,h,k,e,m,u,r,p,x,E,D,w,A,B,y,F,d,n,C,G,z,J;return{init:function(b,d,e){a=b;g=d.arm2;c=e;v()},reset:v,resetSliding:function(a){if(!(2<
a||0>a||a==C)){G=a;a=G-C;0<a?n=-.2:(n=.2,a*=-1);if(2==a)z=79;else switch(C){case 0:z=59;break;case 1:z=0<n?59:39;break;case 2:z=39}d=0;J=z}},push:function(){0<=z&&(z>J-20?d+=n:20>z&&(d-=n),F+=d,D=a.screenWidth/2+F,w=a.screenHeight/2,z--,0>z&&(C=G));if(A==D&&B==w)y=0;else{if(15>=Math.sqrt((D-A)*(D-A)+(w-B)*(w-B)))A=D,B=w;else{var b=l(A,B,D,w);A+=15*Math.cos(b);B+=15*Math.sin(b)}y=1;q(A,B)}},draw:function(){c.drawImage(g,0,130,158,125,a.screenWidth-158+F,a.screenHeight-125,158,125);c.save();c.setTransform(1,
0,0,1,0,0);c.translate(e,m);c.rotate(E);c.drawImage(g,152,95,40,40,-25,-17,40,40);c.restore();c.save();c.setTransform(1,0,0,1,0,0);c.translate(h,k);c.rotate(x);c.drawImage(g,0,0,196,50,-160,-20,196,50);c.restore();c.save();c.setTransform(1,0,0,1,0,0);c.translate(f,b);c.rotate(p);c.drawImage(g,0,50,150,83,-23,-22,150,83);c.restore()},setTarget:function(a,b){D=a;w=b},getLaserHead:function(){return[u,r]},isMoving:function(){return y},isSliding:function(){return 0>z?0:1}}}(),title=function(){var v,q,
l,c,g,a,f,b;return{init:function(a,b,c){v=a;q=v.screenWidth/2;l=v.screenHeight/2},reset:function(){ai.presetBoard(12,[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,-1,-1,-1,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,-1,-1,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,-1,-1,-1,-1,-1,67,67,67,62,62,62,62,62,62,68,68,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,63,63,63,63,63,-1,-1,69,-1,-1,-1,-1,-1,-1,-1,-1,-1,64,63,63,63,63,63,63,65,69,70,70,-1,-1,-1,-1,
-1,-1,64,64,63,63,63,63,63,65,65,-1,70,-1,-1,-1,-1,-1,-1,-1,-1,64,66,66,66,66,66,66,65,71,-1,70,-1,-1,-1,-1,-1,-1,-1,66,66,66,66,66,66,66,-1,71,71,72,-1,-1,-1,-1,-1,-1,-1,-1,66,66,66,66,66,66,-1,-1,-1,72,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],1,1);ai.setColor(1,0);ai.setColor(3,2);ai.setColor(4,1);ai.setColor(7,3);ui.setOverlap(0,"title");ui.setOverlap(2,"p1Game");ui.setOverlap(5,"p2Game");ui.resetSlideIn(2,0,1,0);c=0;g=1;f=a=0},push:function(){ui.push();if(1==ui.isIdle()&&0==
c)switch(c=g,c){case 3:ui.resetSlideOut(2,0,1,0);c=0;g=4;break;case 4:ui.clearOverlap()}return 4==c?[v.mainStates.game,a,f]:[v.mainStates.unknown,a,f]},draw:function(){ui.draw()},eventMouseMove:function(a,f){q=a;l=f;switch(c){case 1:arm1.setTarget(a,f);hud.checkMousePassSound(a,f,0);b=ui.selection(a,f);ui.setSelect(b,0);break;case 2:panel.select(a,f)}},eventMouseClick:function(h){switch(c){case 1:0<=hud.checkMousePassSound(q,l,0)&&hud.setSoundon((hud.getSoundon()+1)%2);2==b?(panel.popup(q,l,b,[7,
8,9]),c=2):5==b?(panel.popup(q,l,b,[0,1,6]),c=2):0<=b&&(panel.popup(q,l,b,[0,1,2]),c=2);break;case 2:h=panel.select(q,l),-1==h?(panel.close(),c=1,b=ui.selection(q,l),ui.setSelect(b,0)):0<=h&&(panel.close(),2==b?(ui.resetPaint(b,3,0),a=1,f=0==h?1:1==h?5:9,g=3):5==b?(ui.resetPaint(b,3,0),a=2,f=1,g=3):(ui.resetPaint(b,h+1,0),g=1),b=-1,ui.setSelect(-1,0),c=0)}}}}(),tutorial=function(){function v(){ai.presetBoard(6,[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,62,62,62,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,62,62,62,62,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,63,63,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,65,64,64,64,63,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,65,64,64,63,63,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,66,66,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],5,3);ai.setColor(4,2);ai.setColor(5,3);hud.setInfo(0,1);f=a.animating;b=a.dialog1}function q(b,e){c=b;g=e;switch(f){case a.dialog1:dialog.checkPassSlot1(b,e,0);dialog.checkPassSlot3(b,e,0);break;case a.dialog2:arm1.setTarget(b,e);h=ui.selection(b,e);3==h?ui.setSelect(h,0):(ui.setSelect(-1,0),h=-1);break;case a.dialog3:panel.select(b,e);break;case a.dialog4:arm1.setTarget(b,e);h=ui.selection(b,e);0==h?ui.setSelect(h,0):(ui.setSelect(-1,0),
h=-1);break;case a.selectColor:panel.select(b,e);break;case a.dialog5:dialog.checkPassSlot2(b,e,0);break;case a.dialog6:dialog.checkPassSlot1(b,e,0),dialog.checkPassSlot3(b,e,0)}}var l,c,g,a={unknown:-1,animating:0,dialog1:1,dialog2:2,dialog3:3,switchToAI:4,aiPaint:5,switchBack:6,dialog4:7,selectColor:8,switchToAI2:9,dialog5:10,dialog6:11,leaving:12},f,b,h;return{init:function(a,b,f){l=a;c=l.screenWidth/2;g=l.screenHeight/2},reset:v,push:function(){ui.push();if(1==ui.isIdle()&&f==a.animating)switch(f=
b,f){case a.dialog1:dialog.popup("tutorial1");break;case a.dialog2:dialog.popup("tutorial2",0);ui.setFocusTargets([3]);break;case a.dialog3:dialog.transform("tutorial3",0);ui.setFocusTargets([4,5,3]);break;case a.switchToAI:ui.resetSwitching(1);f=a.animating;b=a.aiPaint;break;case a.aiPaint:ui.resetPaint(1,3,1);f=a.animating;b=a.switchBack;break;case a.switchBack:ui.resetSwitching(0);f=a.animating;b=a.dialog4;break;case a.dialog4:dialog.popup("tutorial4");ui.setFocusTargets([0]);break;case a.selectColor:ui.setFocusTargets([1,
3,0]);break;case a.switchToAI2:ui.resetSwitching(1);f=a.animating;b=a.dialog5;break;case a.dialog5:dialog.popup("tutorial5");ui.setFocusTargets([2]);ui.setSelect(2,0);break;case a.dialog6:dialog.transform("tutorial6"),ui.setFocusTargets([])}return f==a.leaving?l.mainStates.game:l.mainStates.unknown},draw:function(){ui.draw()},eventMouseMove:q,eventMouseClick:function(k){switch(f){case a.dialog1:0<=dialog.checkPassSlot1(c,g,0)&&(dialog.close(),f=a.animating,b=a.leaving);0<=dialog.checkPassSlot3(c,
g,0)&&(dialog.close(),ui.resetSlideIn(2,1,2,0),f=a.animating,b=a.dialog2);break;case a.dialog2:3==h&&(panel.popup(c,g,h,[0,1,2]),f=a.animating,b=a.dialog3);break;case a.dialog3:res=panel.select(c,g);-1==res?(panel.close(),f=a.animating,b=a.dialog2):0<=res&&(panel.close(),dialog.close(),ui.resetPaint(h,res+1,0),h=-1,ui.setSelect(-1,0),f=a.animating,b=a.switchToAI);break;case a.dialog4:0==h&&(panel.popup(c,g,h,[0,1,2]),f=a.animating,b=a.selectColor);break;case a.selectColor:res=panel.select(c,g);-1==
res?(panel.close(),ui.setFocusTargets([0]),f=a.dialog4,q(c,g)):0<=res&&(panel.close(),dialog.close(),ui.resetPaint(h,res+1,0),h=-1,ui.setSelect(-1,0),f=a.animating,b=a.switchToAI2);break;case a.dialog5:0<=dialog.checkPassSlot2(c,g,0)&&(ui.setSelect(-1,0),f=a.animating,b=a.dialog6);break;case a.dialog6:0<=dialog.checkPassSlot1(c,g,0)&&(dialog.close(),ui.resetSlideOut(2,1,1,0),v(),f=a.animating,b=a.dialog1),0<=dialog.checkPassSlot3(c,g,0)&&(dialog.close(),ui.resetSlideOut(2,1,1,0),f=a.animating,b=a.leaving)}}}}(),
ui=function(){function v(a){var b=ai.getSubGraph(a),d=ai.getBorder(a),c=Math.floor(d[1])-Math.floor(d[3])+1,f=d[2]-d[0]+1,g=d[0],d=d[3],h=0<d-Math.floor(d)?1:0,k,n,l,d=H[a].length=0;k=-1;for(l=0;l<c*f;l++)" "==b[l]?H[a].push(P):(H[a].push(-3*d),d++,n=l,0>k&&(k=l));offset=1==h?0==g%2?-1*e/2:0:1==g%2?e/2:0;b=k*e+e/2+offset+B;k=m/2+B;offset=1==h?0==(g+f-1)%2?-1*e/2:0:1==(g+f-1)%2?e/2:0;c=n%c*e+e/2+offset+B;f=f*m*.75+B;J[a]=0;return[3*d+10,b,k,c,f]}function q(a,b){if(!(0>a)){var c=ai.getBorder(a),g=Math.floor(c[1])-
Math.floor(c[3])+1,h=c[2]-c[0]+1,k=c[0],c=c[3],c=0<c-Math.floor(c)?1:0,n=ai.getSubGraph(a);d[a].clearRect(0,0,F[a].width,F[a].height);var l,p,q,I,r,M;if(0!=b)for(l=0;l<h;l++)for(q=l*g,I=1==c?0==(k+l)%2?-1*e/2:0:1==(k+l)%2?e/2:0,p=0;p<g;p++)" "!=n[q+p]&&(r=p*e+I,M=l*m*.75,d[a].drawImage(f.glow,80*(b-1),0,80,86,r,M,80,86));var v=ai.getColor(a),u;for(l=0;l<h;l++)for(q=l*g,I=1==c?0==(k+l)%2?-1*e/2:0:1==(k+l)%2?e/2:0,p=0;p<g;p++)if(" "!=n[q+p]){u=q+p;r=B+p*e+I;M=B+l*m*.75;-1!=J[a]?0>=H[a][u]?d[a].drawImage(f.tiles,
0,0,e,m,r,M,e,m):0<H[a][u]&&10>=H[a][u]?d[a].drawImage(f.tiles,e*H[a][u],m*v,e,m,r,M,e,m):d[a].drawImage(f.tiles,10*e,m*v,e,m,r,M,e,m):-1!=v?d[a].drawImage(f.tiles,10*e,m*v,e,m,r,M,e,m):d[a].drawImage(f.tiles,0,0,e,m,r,M,e,m);u=n;var w=q+p,x=g,y=h,z=k,A=[1,1,1];if(" "!=u[w]){var C=w%x,K=Math.floor(w/x),E=void 0;C!=x-1&&" "!=u[w+1]&&(A[0]=0);E=1==(z+K)%2?w+x+1:w+x;K!=y-1&&(1==(z+K)%2&&C==x-1||" "==u[E]||(A[1]=0));E=1==(z+K)%2?w+x:w+x-1;K!=y-1&&(0==(z+K)%2&&0==C||" "==u[E]||(A[2]=0))}u=A;1==u[0]&&d[a].drawImage(f.tileBorder,
0,0,e,m,r,M,e,m);1==u[1]&&d[a].drawImage(f.tileBorder,e,0,e,m,r,M,e,m);1==u[2]&&d[a].drawImage(f.tileBorder,2*e,0,e,m,r,M,e,m)}0>a||a>=D||(g=F[a].width/2,h=F[a].height/2,"title"==L[a]?d[a].drawImage(f.title,0,0,520,80,g-260,h-45,520,80):"p1Game"==L[a]?d[a].drawImage(f.title,0,80,190,37,g-95,h-20,190,37):"p2Game"==L[a]&&d[a].drawImage(f.title,260,80,216,37,g-108,h-20,216,37))}}function l(a,b){var d=-1,c=-1,f;for(f=0;f<u;f+=.5)if(a>=w+B+e*f&&a<w+B+e*(f+.5)){d=f;break}for(f=0;f<r;f++)if(b>=A+B+m*f*.75&&
b<A+B+m*(f+1)*.75){c=f;break}if(-1==d||-1==c||0==c)return-1;var g=d>Math.floor(d)?1:0,h,k;f=A+B+c*m*.75+m/2;k=A+B+(c-1)*m*.75+m/2;0==c%2&&0==g||1==c%2&&1==g?(h=w+B+d*e,g=h+e/2):(g=w+B+d*e,h=g+e/2);(a-g)*(a-g)+(b-f)*(b-f)<(a-h)*(a-h)+(b-k)*(b-k)?(f=c*u,f=1==c%2?f+Math.floor(d-.5):f+Math.floor(d)):(f=(c-1)*u,f=1==c%2?f+Math.floor(d):f+Math.floor(d-.5));d=ai.findGroup(f);return-1==d?-1:-1!=ai.getColor(d)?-1*d-1:d}function c(){for(var a=0;a<D;a++)L[a]=""}function g(a,b){a!=x&&(0>a&&0<=x?q(x,0):(0<=a&&
0>x||q(x,0),q(a,b+1)),x=a)}var a,f,b,h=0,k=0,e=40,m=46,u,r,p,x=-1,E,D=25,w=20,A=20,B=20,y,F=Array(D),d=[],n=[],C=[],G=[],z=[],J=[],H=[],P=-99999,O=0,N,L=Array(D),M,I,K,T,R,S,V,U,Q,X,Z,W,da,Y,aa,ba,ca=[];return{init:function(d,e,g){b=d;f=e;a=g;for(d=0;d<D;d++)F[d]=document.createElement("canvas");E=0;N=-1;c();ba=aa=0;ca.length=0},resetSlideIn:function(a,c,f,l){u=ai.getMaxCol();r=ai.getMaxRow();p=ai.getGraphSize();arm1.resetSliding(a);arm2.resetSliding(c);hud.resetSliding(f);f=13*Math.ceil(1.2*b.screenWidth/
13);d.length=0;n.length=0;C.length=0;G.length=0;z.length=0;J.length=0;for(a=H.length=0;a<p;a++)c=ai.getBorder(a),F[a].width=(c[1]-c[3]+1)*e+2*B,F[a].height=(c[2]-c[0])*m*.75+m+2*B,d.push(F[a].getContext("2d")),n.push(w+c[3]*e),1==a%2?C.push(n[a]-f):C.push(n[a]+f),G.push(A+c[0]*m*.75),z.push(.02*(p-a-1)),J.push(-1),H[a]=[],q(a,0);1==l&&warp.resetFade(0);g(-1,0);h=1;k=0;y=1},resetSlideOut:function(a,d,c,f){var e,l=13*Math.ceil(1.2*b.screenWidth/13);for(e=0;e<p;e++)n[e]=0==e%2?C[e]-l:C[e]+l;1==f?(arm1.resetSliding(0),
arm2.resetSliding(0),warp.resetFade(1),k=5):(arm1.resetSliding(a),arm2.resetSliding(d),k=0);hud.resetSliding(c);g(-1,0);h=2;y=4},resetPaint:function(a,b,d){if(-1!=a){ai.setColor(a,b);var c=v(a),f=c[1],e=c[2],k=c[3],l=c[4],c=c[0];Z=-1*a-1;W=d;da=b-1;V=C[a]+f;U=G[a]+e;Q=C[a]+k;X=G[a]+l;R=V;S=U;M=Y=0;I=c;0==d?arm1.setTarget(V,U):arm2.setTarget(V,U);b=ai.getBlackout();for(a=0;a<b.length;a++)ai.setColor(b[a],0),v(b[a]);g(-1,0);h=3;N=0}},push:function(){warp.pushFade();if(1==warp.isWarping())warp.pushWarp(),
0==warp.isWarping()&&(h=0);else{var a,b;switch(y){case 1:b=p;for(a=0;a<p;a++)C[a]<n[a]?C[a]+=13:C[a]>n[a]?C[a]-=13:b--;0==b&&(y=2);break;case 2:b=p;for(a=0;a<p;a++)0<z[a]?z[a]-=.01:b--;0==b&&(h=0,y=3);break;case 4:b=p;for(a=0;a<p;a++)z[a]<.02*(p-a-1)?z[a]+=.01:b--;0==b&&(y=5);break;case 5:b=p;for(a=0;a<p;a++)C[a]<n[a]?C[a]+=13:C[a]>n[a]?C[a]-=13:b--;5==k&&0==warp.isFading()?(arm1.reset(),arm2.reset(),warp.resetWarp(),O=(O+1)%5,h=5,y=k=0):0==b&&(y=k=h=0)}}panel.push();hud.push();dialog.push();a=1;
if(3==h){if(1==N){var d,c,f,e;for(e=0;e<J.length;e++)if(-1!=J[e]){b=-1;d=ai.getBorder(e);c=Math.floor(d[1])-Math.floor(d[3])+1;d=d[2]-d[0]+1;for(f=0;f<c*d;f++)H[e][f]!=P&&(H[e][f]++,10>=H[e][f]&&(b=0));J[e]=b}}1!=N?0==W?(arm1.push(),0==arm1.isMoving()&&(N=1)):(arm2.push(),0==arm2.isMoving()&&(N=1)):(M++,M>I||(b=M/I,R=V+(Q-V)*b,S=U+(X-U)*b,0==W?(arm1.setTarget(R,S),arm1.push()):(arm2.setTarget(R,S),arm2.push()),Y+=Math.floor(7*Math.random()),Y%=7));for(b=0;b<J.length;b++)if(-1!=J[b]){a=0;break}1==
a&&(h=0,N=-1)}else arm1.push(),arm2.push();4==h&&0==arm1.isSliding()&&0==arm2.isSliding()&&(h=0)},draw:function(){a.drawImage(f.backgrounds[O],0,0);if(1==warp.isWarping())warp.drawWarp();else{ai.getBoard();var d,c,e,g,h;for(d=0;d<p;d++)0<z[d]?(c=(C[d]-b.screenWidth/2)*(1-z[d])+b.screenWidth/2,e=(G[d]-b.screenHeight/2)*(1-z[d])+b.screenHeight/2,g=F[d].width*z[d],h=F[d].height*z[d],a.drawImage(F[d],c,e,F[d].width-g,F[d].height-h),1==E&&a.drawImage(f.shadow,c,300+130*(1-z[d]),F[d].width-g,50*(1-z[d]))):
(x!=d&&a.drawImage(F[d],C[d],G[d]),-1!=J[d]&&q(d,0),1==E&&a.drawImage(f.shadow,C[d],430,F[d].width,50));0<=x&&(0==y||3==y)&&a.drawImage(F[x],C[x],G[x]);hud.draw()}arm2.draw();if(1==aa)for(a.fillStyle="rgba(64, 64, 64, "+ba+")",a.fillRect(0,0,b.screenWidth,b.screenHeight),d=0;d<ca.length;d++)t=ca[d],a.drawImage(F[t],C[t],G[t]);arm1.draw();warp.drawFade();panel.draw();if(1==N&&!(M>I)&&l(R,S)==Z){d=0==W?arm1.getLaserHead():arm2.getLaserHead();K=d[0];T=d[1];d=Math.sqrt((R-K)*(R-K)+(S-T)*(S-T));c=K;g=
T;e=R;h=S;var k=Math.sqrt((e-c)*(e-c)+(h-g)*(h-g));g=Math.asin((h-g)/k);e<c&&(g=-1*g+Math.PI);c=g;a.save();a.setTransform(1,0,0,1,0,0);a.translate(K,T);a.rotate(c);a.drawImage(f.beams,0,40*da,d,40,0,-20,d,40);a.drawImage(f.sparks,128*Y,0,128,128,d-64,-64,128,128);a.restore()}2==aa&&(a.fillStyle="rgba(64, 64, 64, "+ba+")",a.fillRect(0,0,b.screenWidth,b.screenHeight));dialog.draw()},selection:l,setSelect:g,setOverlap:function(a,b){L[a]=b},clearOverlap:c,resetSwitching:function(a){0==a%2?(arm1.resetSliding(2),
arm2.resetSliding(1)):(arm1.resetSliding(1),arm2.resetSliding(2));h=4},isIdle:function(){return 0!=h?0:1},setShadow:function(a){E=a},setFocus:function(a,b){aa=0<b?a:0;ba=b},setFocusTargets:function(a){ca=a.slice(0)},drawNumbers:function(a,b,d,c,e){b=b.toString();for(var g,h=0;h<b.length;h++)g=Number(b[h]),a.drawImage(f.numbers,35*g,0,35,54,d+35*h*e,c,35*e,54*e)}}}(),warp=function(){function v(a){1==a?b=h=0:(h=1,b=2);k=0}function q(b,d){var c;a:{for(c=0;144>c;c++)if(0>D[c])break a;c=-1}0>c||(w[c]=
b,D[c]=1,A[c]=d,r[c]=Math.cos(b),p[c]=Math.sin(b),x[c]=a/2,E[c]=f/2)}var l,c,g,a,f,b,h,k,e,m=2,u,r=Array(144),p=Array(144),x=Array(144),E=Array(144),D=Array(144),w=Array(144),A=Array(144),B=Array(80),y=Array(80),F=Array(80),d=Array(80),n=Array(80),C,G,z,J,H,P,O,N,L;return{init:function(b,d,h){g=b;c=d;l=h;a=g.screenWidth+50;f=g.screenHeight+50;N=document.createElement("canvas");N.width=a;N.height=f;L=N.getContext("2d");e=k=-1},resetFade:v,pushFade:function(){if(!(0>k))switch(b){case 0:h+=.1;1<h&&(h=
1,k=30,b=1);break;case 1:k--;break;case 2:h-=.01,0>h&&(h=0,k=-1)}},drawFade:function(){0>k||(l.fillStyle="rgba(255, 255, 255, "+h+")",l.fillRect(0,0,g.screenWidth,g.screenHeight))},isFading:function(){return 0>k?0:1},resetWarp:function(){m++;m%=3;var b;for(b=0;144>b;b++)r[b]=-1,p[b]=-1,x[b]=-1,E[b]=-1,D[b]=-1,w[b]=-1,A[b]=-1;u=0;switch(m){case 0:for(b=0;20>b;b++)q(2*Math.random()*Math.PI,14*Math.random()+6);break;case 1:for(b=0;24>b;b++)q(.26*b,14)}var c,g,h;for(b=0;80>b;b++)g=Math.random()*a,h=Math.random()*
f,c=Math.sqrt(g*g+h*h),B[b]=(g-a/2)/c,y[b]=(h-f/2)/c,F[b]=g,d[b]=h,n[b]=8*Math.random()+2;C=Math.random()+.01;G=Math.random()+.01;z=4*Math.random()+1;J=4*Math.random()+1;O=P=H=0;v(0);haloFrame=Math.floor(4*Math.random());e=0},pushWarp:function(){250<=e&&(e=-1);if(!(0>e)){e++;210==e&&v(1);var b;for(b=0;144>b;b++){var c=b;if(!(0>D[c])){A[c]+=.5;D[c]+=A[c];x[c]=r[c]*D[c]+a/2;E[c]=p[c]*D[c]+f/2;var g=x[c],h=E[c];if(0>g||g>a||0>h||h>f)D[c]=-1,0==m&&q(2*Math.random()*Math.PI,14*Math.random()+6)}}switch(m){case 1:if(0==
e%25)for(b=0;24>b;b++)q(.26*b,14);break;case 2:0==e%2&&(q(.31*u,14),q(.31*u+Math.PI,14),u++)}for(b=0;80>b;b++)if(c=b,!(0>n[c])&&(F[c]+=B[c]*n[c],d[c]+=y[c]*n[c],g=F[c],h=d[c],0>g||g>a||0>h||h>f))g=2*Math.random()*Math.PI,n[c]=8*Math.random()+2,B[c]=Math.cos(g),y[c]=Math.sin(g),F[c]=B[c]*n[c]*5+a/2,d[c]=y[c]*n[c]*5+f/2;0>O||(O+=1,b=e/250,H=z*b*Math.cos(O/C),P=J*b*Math.cos(O/G))}},drawWarp:function(){L.fillStyle="#000000";L.fillRect(0,0,a,f);switch(haloFrame){case 0:L.drawImage(c.halo,0,0,512,512,(a-
512)/2-H,(f-512)/2-P,512,512);break;case 1:L.drawImage(c.halo,512,0,512,512,(a-512)/2-H,(f-512)/2-P,512,512);break;case 2:L.drawImage(c.halo,0,512,512,512,(a-512)/2-H,(f-512)/2-P,512,512);break;case 3:L.drawImage(c.halo,512,512,512,512,(a-512)/2-H,(f-512)/2-P,512,512)}var b;for(b=0;80>b;b++)0<=n[b]&&L.drawImage(c.dot,F[b],d[b]);var e;for(b=0;144>b;b++)0<=D[b]&&(L.save(),L.setTransform(1,0,0,1,0,0),L.translate(x[b],E[b]),L.rotate(w[b]),e=A[b]*A[b]/600,L.drawImage(c.warpLine,0,0,203*D[b]*e/100,9*D[b]*
e/100),L.restore());l.drawImage(N,-25+H,-25+P)},isWarping:function(){return 0>e?0:1}}}();