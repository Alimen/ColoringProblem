function canvasSupport(){return!!document.createElement("testcanvas").getContext}function eventWindowLoaded(){coloringProblem.startMessageLoop()}var ai=function(){function n(){var c,d,e,a=Array();for(d=0;j.length>d;d++)for(e=1;3>=e;e++)1==G(j[d],e)&&a.push(10*j[d]+e);var f=a.slice(0);if(console.log("candidates = ",a),o(a,j.length),console.log("candidates after defensivePick() = ",a),p(a),console.log("candidates after offensivePick() = ",a),.5>Math.random()&&(q(a),console.log("candidates after monopolyPick() = ",a)),100*Math.random()>=m){var g=Array();for(d=0;f.length>d;d++)-1==a.indexOf(f[d])&&g.push(f[d]);g.length>0&&(a=g),console.log("candidates after inverse = ",a)}return c=r(a)}function o(a){var d,e,b=Array(),c=0,f=Array();for(d=0;a.length>d;d++)e=s(a[d]),f.push(e),e>0&&j.length%2==e%2&&b.push(a[d]);if(b.length>0){for(a.length=b.length,d=0;b.length>d;d++)a[d]=b[d];0==j.length%2&&(c=1)}return c}function p(a){var f,g,h,i,k,l,m,b=Array(),c=Array(),e=Array(),n=d.slice(0),p=j.slice(0);for(g=0;a.length>g;g++){for(k=Math.floor(a[g]/10),l=a[g]%10,E(k,l),I(),b.length=0,h=0;j.length>h;h++)for(f=1;3>=f;f++)1==G(j[h],f)&&b.push(10*j[h]+f);m=o(b),0==m?c.push(-1):c.push(b.length),d=n.slice(0),j=p.slice(0)}for(i=0,e.push(a[0]),f=1;c.length>f;f++)c[f]==c[i]?e.push(a[f]):c[f]<c[i]&&(i=f,e.length=0,e.push(a[f]));if(e.length>0)for(a.length=e.length,f=0;e.length>f;f++)a[f]=e[f]}function q(a){if(!(1>=a.length)){var b,e,c=Math.floor(a[0]/10),d=Array(),g=0;for(d.push(a[0]),e=1;a.length>e;e++)b=Math.floor(a[e]/10),f[b].length>f[c].length?(g=e,c=b,d.length=0,d.push(a[e])):f[b].length==f[c].length&&d.push(a[e]);if(d.length>0)for(a.length=d.length,e=0;d.length>e;e++)a[e]=d[e]}}function r(a){return a[Math.floor(Math.random()*a.length)]}function s(a){var h,b=Math.floor(a/10),c=a%10,g=0;if(-1!=D(b)||0==G(b,c))return 0;for(h=d[e[b][0]],F(b,c),i=0;f[b].length>i;i++)-1==D(f[b][i])&&1==H(f[b][i])&&g++;return F(b,h),g+1}function t(c,i,m,n){for(d=i.slice(0),k=m,l=n,e.length=c,f.length=c,o=0;c>o;o++)e[o]=Array(),f[o]=Array();var o,p;for(o=0;216>o;o++)d[o]>=61&&e[d[o]-61].push(o);for(o=0;c-1>o;o++)for(p=o+1;c>p;p+=1)1==x(e[o],e[p])&&(f[o].push(p),f[p].push(o));for(g.length=0,h.length=0,o=0;c>o;o++)g.push(B(o+61)),h.push(C(o+61));for(j.length=0,o=0;c>o;o++)j.push(o)}function u(i,m,n){i>c&&(i=c),k=m>6?6:m,l=n>3?3:n;const o=5;var r,s,t,p=Array(),q=Array(216);for(v(p),e.length=i,f.length=i,r=0;i>r;r++)e[r]=Array(),f[r]=Array();var u,y=Array();for(r=0;o>r;){for(t=p[Math.floor(Math.random()*p.length)],u=0,s=0;y.length>s;s++)if(1==z(t,y[s])||t==y[s]){u=1;break}0==u&&(y.push(t),d[t]=" ",p.splice(p.indexOf(t),1),r++)}for(q=p.slice(0),K(q),r=0;i>r;r++)d[q[r]]=r+61,e[r].push(q[r]),p.splice(p.indexOf(q[r]),1);for(;p.length>0;)for(s=p.length,q=p.slice(0),K(q),r=0;s>r;r++)t=w(q[r]),t>=0&&(d[q[r]]=t+61,e[t].push(q[r]),p.splice(p.indexOf(q[r]),1));for(r=0;i-1>r;r++)for(s=r+1;i>s;s+=1)1==x(e[r],e[s])&&(f[r].push(s),f[s].push(r));for(g.length=0,h.length=0,r=0;i>r;r++)g.push(B(r+61)),h.push(C(r+61));for(j.length=0,r=0;i>r;r++)j.push(r)}function v(c){var e;for(c.length=0,e=0;216>e;e++)1==A(e)?d[e]=" ":(d[e]="0",c.push(e))}function w(a){var c,d,b=Array();for(c=0;e.length>c;c++)1==y(e[c],a)&&b.push(c);if(1>b.length)return-1;if(1==b.length)return b[0];for(d=0,c=1;b.length>c;c++)e[c].length<e[d].length&&(d=c);return b[d]}function x(a,b){for(var c=0;b.length>c;c++)if(1==y(a,b[c]))return 1;return 0}function y(a,b){for(var c=0;a.length>c;c++)if(1==z(a[c],b))return 1;return 0}function z(a,c){var e,d=Math.floor(a/b);return e=1==d%2?1:-1,a+1==c||a-1==c||a-b==c||a-b+e==c||a+b==c||a+b+e==c?1:0}function A(c){return b*l>c||c>=(a-l)*b?1:k>c%b||c%b>=b-k?1:1==Math.floor(c/b)%2&&c%b==b-k-1?1:0}function B(c){var e,f,g,h,i,j,k=C(c),l=k[0],m=k[1],n=k[2],o=k[3];e=Math.floor(m)-Math.floor(o)+1,f=n-l+1;var p=Array(216);for(i=0,g=l;n>=g;g++)for(j=g*b,h=Math.floor(o);Math.floor(m)>=h;h++)p[i]=d[j+h]==c?d[j+h]:" ",i++;return p}function C(c){var e,f,g,h,i=-1,j=-1,k=-1,l=-1;for(e=0;a>e;e++){for(g=e*b,f=0;b>f;f++)if(c==d[g+f]){i=e;break}if(i>-1)break}for(;a>e;e++){for(g=e*b,f=0;b>f;f++)if(c==d[g+f]){j=e;break}if(e>j)break}for(e=0;36>e;e++){for(h=e%2?b+(e-1)/2:e/2,f=h;216>f;f+=36)if(c==d[f]){k=e/2;break}if(k>-1)break}for(e=35;e>=0;e--){for(h=e%2?b+(e-1)/2:e/2,f=h;216>f;f+=36)if(c==d[f]){l=e/2;break}if(l>-1)break}return[i,l,j,k]}function D(a){return d[e[a][0]]>3||0>d[e[a][0]]?-1:d[e[a][0]]}function E(a,b){F(a,b),j.splice(j.indexOf(a),1)}function F(a,b){for(var c=0;e[a].length>c;c++)d[e[a][c]]=b}function G(a,b){var c;for(c=0;f[a].length>c;c++)if(d[e[f[a][c]][0]]==b)return 0;return 1}function H(a){return 0==G(a,1)&&0==G(a,2)&&0==G(a,3)?1:0}function I(){var a,b=Array();for(a=0;j.length>a;a++)1==H(j[a])&&b.push(j[a]);return b}function J(a){var b;for(b=0;e.length>b;b++)if(-1!=e[b].indexOf(a))return b;return-1}function K(a){for(var b,c,d,e=0;a.length>e;e++)b=Math.random(),b*=a.length,b=Math.floor(b),c=Math.random(),c*=a.length,c=Math.floor(c),d=a[b],a[b]=a[c],a[c]=d}function L(a){m=a}function M(){return a}function N(){return b}function O(){return d}function P(){return f.length}function Q(a){return g[a]}function R(a){return h[a]}function S(){return j.length}const a=12,b=18,c=25;var k,l,d=Array(216),e=Array(),f=Array(),g=Array(),h=Array(),j=Array(),m=100;return{setAIability:L,aiPick:n,presetBoard:t,setupBoard:u,findGroup:J,getMaxRow:M,getMaxCol:N,getBoard:O,getGraphSize:P,getColor:D,setColor:E,isColorOK:G,getSubGraph:Q,getBorder:R,getBlackout:I,getUncoloredCount:S}}(),coloringProblem=function(){function I(){var a;switch(G){case F.initial:R();break;case F.preloading:S();break;case F.initLoader:X();break;case F.loading:loader.draw(Math.ceil(100*W/V)),bb();break;case F.loadComplete:Z(),loader.resetLogoSliding({tiles:i,tileBorder:j,html5:k,background:B[0]}),G=F.showLogo;break;case F.showLogo:a=loader.pushLogoSliding(),loader.drawLogoSliding(),bb(),a!=F.unknown&&(G=F.resetTitle);break;case F.resetTitle:title.reset(),G=F.title;break;case F.title:H=title.push(),title.draw(),bb(),H[0]!=F.unknown&&(1==Q?(Q=0,tutorial.reset(),G=F.tutorial):(G=F.game,gameLogic.reset(H[1],H[2])));break;case F.tutorial:a=tutorial.push(),tutorial.draw(),bb(),a!=F.unknown&&(G=F.game,gameLogic.reset(H[1],H[2]));break;case F.game:a=gameLogic.push(),gameLogic.draw(),bb(),a!=F.unknown&&(G=a)}}function L(a){switch(a.offsetX||0==a.offsetX?(J=a.offsetX,K=a.offsetY):(a.layerX||0==a.layerX)&&(J=a.layerX-c.offsetLeft,K=a.layerY-c.offsetTop),G){case F.title:title.eventMouseMove(J,K);break;case F.tutorial:tutorial.eventMouseMove(J,K);break;case F.game:gameLogic.eventMouseMove(J,K)}}function M(a){switch(G){case F.title:title.eventMouseClick(a);break;case F.tutorial:tutorial.eventMouseClick(a);break;case F.game:gameLogic.eventMouseClick(a)}}function R(){b="",N++,T("script/Loader.js",1),i.src=b+"image/Tiles.png",i.onload=U,j.src=b+"image/TileBorder.png",j.onload=U,c=document.getElementById("canvas"),d=c.getContext("2d"),e=document.createElement("canvas"),e.width=c.width,e.height=c.height,f=e.getContext("2d"),c.addEventListener("mousemove",L,!0),c.addEventListener("click",M,!0),Q=1,G=F.preloading}function S(){var a=Math.round(100*(O/N));d.fillStyle="#FFFFFF",d.fillRect(0,0,g,h),d.textBaseline="bottom",d.fillStyle="#000000",d.font="14px monospace",d.textAlign="center",d.fillText(a+"%",400,240)}function T(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",a),c.onload=1==b?U:Y,document.getElementsByTagName("head")[0].appendChild(c)}function U(){O++,O==N&&(G=F.initLoader)}function X(){V+=10,T("script/Title.js",0),T("script/GameLogic.js",0),T("script/UI.js",0),T("script/Dialog.js",0),T("script/Panel.js",0),T("script/RoboticArms.js",0),T("script/HUD.js",0),T("script/Warp.js"),T("script/AI.js",0),T("script/Tutorial.js",0),$(),k.src=b+"image/HTML5_Logo.png",k.onload=Y,l.src=b+"image/Shadow.png",l.onload=Y,m.src=b+"image/Glow.png",m.onload=Y,n.src=b+"image/Panel.png",n.onload=Y,o.src=b+"image/Bottons.png",o.onload=Y,p.src=b+"image/Beam.png",p.onload=Y,q.src=b+"image/Sparks.png",q.onload=Y,r.src=b+"image/Arm1.png",r.onload=Y,s.src=b+"image/Arm2.png",s.onload=Y,t.src=b+"image/Dot.png",t.onload=Y,u.src=b+"image/Warpline.png",u.onload=Y,v.src=b+"image/Halos.jpg",v.onload=Y,w.src=b+"image/Misc.png",w.onload=Y,x.src=b+"image/Dialog.jpg",x.onload=Y,y.src=b+"image/Title.png",y.onload=Y,z.src=b+"image/Numbers.png",z.onload=Y,A.src=b+"image/HUD.png",A.onload=Y;for(var c=0;5>c;c++)B[c]=new Image,B[c].src=b+"image/Background"+c+".jpg",B[c].onload=Y;loader.init(P,{tiles:i,tileBorder:j},f),G=F.loading}function Y(){W++,W==V&&(G=F.loadComplete)}function Z(){_(),title.init(P,{},f),gameLogic.init(P,{},f),ui.init(P,{tiles:i,tileBorder:j,backgrounds:B,shadow:l,glow:m,title:y,beams:p,sparks:q,misc:w,numbers:z},f),dialog.init(P,{panel:n,glow:m,misc:w,dialog:x},{result0:C,result1:D,result2:E},f),panel.init(P,{panel:n,bottons:o},f),arm1.init(P,{arm1:r},f),arm2.init(P,{arm2:s},f),hud.init(P,{glow:m,misc:w,hud:A,title:y,dialog:x},f),warp.init(P,{dot:t,warpLine:u,halo:v},f),tutorial.init(P,{},f)}function $(){var a;C=document.createElement("audio"),document.body.appendChild(C),a=ab(C),C.setAttribute("src",b+"sound/Result0"+a),C.addEventListener("canplaythrough",Y,!1),D=document.createElement("audio"),document.body.appendChild(D),D.setAttribute("src",b+"sound/Result1"+a),D.addEventListener("canplaythrough",Y,!1),E=document.createElement("audio"),document.body.appendChild(E),E.setAttribute("src",b+"sound/Result2"+a),E.addEventListener("canplaythrough",Y,!1)}function _(){C.removeEventListener("canplaythrough",Y,!1),D.removeEventListener("canplaythrough",Y,!1),E.removeEventListener("canplaythrough",Y,!1)}function ab(a){var b="";return"probably"==a.canPlayType("audio/ogg")||"maybe"==a.canPlayType("audio/ogg")?b=".ogg":("probably"==a.canPlayType("audio/mp3")||"maybe"==a.canPlayType("audio/mp3"))&&(b=".mp3"),b}function bb(){d.drawImage(e,0,0)}function cb(){const a=30;var b=1e3/a;setInterval(I,b)}if(canvasSupport){var b,c,d,e,f;const g=800,h=480;var C,D,E,i=new Image,j=new Image,k=new Image,l=new Image,m=new Image,n=new Image,o=new Image,p=new Image,q=new Image,r=new Image,s=new Image,t=new Image,u=new Image,v=new Image,w=new Image,x=new Image,y=new Image,z=new Image,A=new Image,B=Array(5);const F={unknown:-1,initial:0,preloading:1,initLoader:2,loading:3,loadComplete:4,showLogo:5,resetTitle:6,title:7,tutorial:8,game:9};var H,J,K,Q,G=F.initial,N=2,O=0,P={mainStates:F,screenWidth:g,screenHeight:h},V=25,W=0;return{startMessageLoop:cb}}}();window.addEventListener("load",eventWindowLoaded,!1);var dialog=function(){function H(e,f,h,l){d=e,b=f,c=h,a=l,k=0,g=-1,i=document.createElement("canvas"),i.width=d.screenWidth,i.height=d.screenHeight,j=i.getContext("2d")}function I(a,b){l=0,m=0,n=20,o=20,p=0,h=10,T(a,b),l=x[2],m=x[3],q=0,r=0,u=.5/h,k=1,g=0,x[0]>=v.p1Wins&&x[0]<=v.playerWins&&W()}function J(){h=10,q=0,r=0,s=x[4]/h,t=x[5]/h,u=.5/h,k=3,g=0}function K(a,b){2==k&&(h=15,T(a,b),u=0,k=1,g=0,x[0]==v.tutorial6&&W())}function L(){2==k&&(h=15,q=(765-x[2])/h,r=(17-x[3])/h,s=(x[4]-20)/h,t=(x[5]-20)/h,u=.5/h,k=4,g=0)}function M(){5==k&&(h=15,q=(x[2]-765)/h,r=(x[3]-17)/h,s=(x[4]-20)/h,t=(x[5]-20)/h,u=.5/h,k=6,g=0)}function N(){if(!(0>g)){var a;switch(a=x[0]>v.tutorial1&&x[0]<v.tutorial6?1:2,k){case 0:break;case 1:l+=q,m+=r,n+=s,o+=t,p+=u,g++,g==h&&(p=.5,k++),ui.setFocus(a,p);break;case 2:break;case 3:l-=q,m-=r,n-=s,o-=t,p-=u,g++,g==h&&(p=0,k=0,g=-1),ui.setFocus(a,p);break;case 4:l+=q,m+=r,n-=s,o-=t,p-=u,g++,g==h&&(p=0,k++,g=-1),ui.setFocus(a,p);break;case 5:break;case 6:l+=q,m+=r,n+=s,o+=t,p+=u,g++,g==h&&(p=.5,k=2),ui.setFocus(a,p)}}}function O(){0!=k&&5!=k&&(1==k||3==k||4==k||6==k?(a.drawImage(i,0,0,10,10,l-n/2,m-o/2,10,10),a.drawImage(i,x[4]-10,0,10,10,l+n/2-10,m-o/2,10,10),a.drawImage(i,x[4]-10,x[5]-10,10,10,l+n/2-10,m+o/2-10,10,10),a.drawImage(i,0,x[5]-10,10,10,l-n/2,m+o/2-10,10,10),o-20>0&&(a.drawImage(i,0,10,10,x[5]-20,l-n/2,m-o/2+10,10,o-20),a.drawImage(i,x[4]-10,10,10,x[5]-20,l+n/2-10,m-o/2+10,10,o-20)),n-20>0&&(a.drawImage(i,10,0,x[4]-20,10,l-n/2+10,m-o/2,n-20,10),a.drawImage(i,10,x[5]-10,x[4]-20,10,l-n/2+10,m+o/2-10,n-20,10)),o-20>0&&n-20>0&&a.drawImage(b.panel,10,10,10,10,l-n/2+10,m-o/2+10,n-20,o-20)):(a.drawImage(i,l-n/2,m-o/2),P()))}function P(){if(2==k){var c,d;B!=y.none&&(c=l-n/3-40,d=m-o/2+(o-A-10),E>=0&&a.drawImage(b.glow,80*E,0,80,86,c,d-20,80,86),a.drawImage(b.misc,B,0,80,64,c,d,80,64)),C!=y.none&&(c=l-40,d=m-o/2+(o-A-10),F>=0&&a.drawImage(b.glow,80*F,0,80,86,c,d-20,80,86),a.drawImage(b.misc,C,0,80,64,c,d,80,64)),D!=y.none&&(c=l+n/3-40,d=m-o/2+(o-A-10),G>=0&&a.drawImage(b.glow,80*G,0,80,86,c,d-20,80,86),a.drawImage(b.misc,D,0,80,64,c,d,80,64))}}function Q(a,b,c){return 2!=k?-1:E=a>l-n/2&&l-n/6>=a&&b>m-o/2+(o-A-10)&&m+o/2>b?c:-1}function R(a,b,c){return 2!=k?-1:F=a>l-n/6&&l+n/6>=a&&b>m-o/2+(o-A-10)&&m+o/2>b?c:-1}function S(a,b,c){return 2!=k?-1:G=a>l+n/6&&l+n/2>=a&&b>m-o/2+(o-A-10)&&m+o/2>b?c:-1}function T(a,c){switch(x=U(a),B=y.none,C=y.none,E=-1,F=-1,G=-1,j.clearRect(0,0,i.width,i.height),j.drawImage(b.panel,0,0,10,10,0,0,10,10),j.drawImage(b.panel,90,0,10,10,x[4]-10,0,10,10),j.drawImage(b.panel,90,80,10,10,x[4]-10,x[5]-10,10,10),j.drawImage(b.panel,0,80,10,10,0,x[5]-10,10,10),j.drawImage(b.panel,0,10,10,70,0,10,10,x[5]-20),j.drawImage(b.panel,10,0,80,10,10,0,x[4]-20,10),j.drawImage(b.panel,90,10,10,70,x[4]-10,10,10,x[5]-20),j.drawImage(b.panel,10,80,80,10,10,x[5]-10,x[4]-20,10),j.drawImage(b.panel,10,10,10,10,10,10,x[4]-20,x[5]-20),x[0]){case v.p1Wins:j.drawImage(b.dialog,0,0,228,28,x[4]/2-114,20,228,28),j.drawImage(b.dialog,0,25,72,50,x[4]/2-126,50,72,50),j.drawImage(b.dialog,0,75,144,50,x[4]/2-126+108,50,144,50),B=y.title,C=y.view,D=y.next;break;case v.p2Wins:j.drawImage(b.dialog,0,0,228,28,x[4]/2-114,20,228,28),j.drawImage(b.dialog,72,25,72,50,x[4]/2-126,50,72,50),j.drawImage(b.dialog,0,75,144,50,x[4]/2-126+108,50,144,50),B=y.title,C=y.view,D=y.next;break;case v.aiWins:j.drawImage(b.dialog,0,0,228,28,x[4]/2-114,20,228,28),j.drawImage(b.dialog,360,25,72,50,x[4]/2-126,50,72,50),j.drawImage(b.dialog,0,75,144,50,x[4]/2-126+108,50,144,50),B=y.title,C=y.view,D=y.replay;break;case v.playerWins:j.drawImage(b.dialog,0,0,228,28,x[4]/2-114,20,228,28),j.drawImage(b.dialog,144,25,216,50,x[4]/2-198,50,216,50),j.drawImage(b.dialog,0,75,144,50,x[4]/2-198+252,50,144,50),B=y.title,C=y.view,D=y.next;break;case v.quit:j.drawImage(b.dialog,0,130,300,60,x[4]/2-150,15,300,60),B=y.title,C=y.replay,D=y.cancel;break;case v.level:var d;d=c>=100?105:c>=10?70:35,j.drawImage(b.dialog,144,75,180,50,x[4]/2-(215+d)/2,30,180,50),ui.drawNumbers(j,c,x[4]/2-(215+d)/2+215,28,1),B=y.none,C=y.next,D=y.none;break;case v.tutorial1:j.drawImage(b.dialog,0,190,286,50,x[4]/2-143,30,286,50),B=y.skip,C=y.none,D=y.next;break;case v.tutorial2:j.drawImage(b.dialog,286,214,264,26,x[4]/2-132,17,264,26),B=y.none,C=y.none,D=y.none;break;case v.tutorial3:j.drawImage(b.dialog,0,240,264,94,x[4]/2-132,15,264,94),B=y.none,C=y.none,D=y.none;break;case v.tutorial4:j.drawImage(b.dialog,380,240,170,54,x[4]/2-85,13,170,54),B=y.none,C=y.none,D=y.none;break;case v.tutorial5:j.drawImage(b.dialog,0,334,530,56,x[4]/2-265,15,530,56),B=y.none,C=y.next,D=y.none;break;case v.tutorial6:j.drawImage(b.dialog,270,294,280,40,x[4]/2-140,15,280,40),j.drawImage(b.dialog,442,25,108,50,x[4]/2-126,65,108,50),j.drawImage(b.dialog,0,75,108,50,x[4]/2-126+144,65,108,50),B=y.replay,C=y.none,D=y.next}q=(x[2]-l)/h,r=(x[3]-m)/h,s=(x[4]-n)/h,t=(x[5]-o)/h}function U(a){var b,c=w[0];for(b=0;w.length>b;b++)if(w[b][1]==a){c=w[b];break}return c}function W(){if(0!=hud.getSoundon()){switch(V){case 0:c.result0.currentTime=0,c.result0.play();break;case 1:c.result1.currentTime=0,c.result1.play();break;case 2:c.result2.currentTime=0,c.result2.play()}V=(V+1)%3}}var a,b,c,d;var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;const v={unknown:-1,p1Wins:1,p2Wins:2,aiWins:3,playerWins:4,quit:5,level:6,tutorial1:7,tutorial2:8,tutorial3:9,tutorial4:10,tutorial5:11,tutorial6:12},w=[[v.unknown,"unknown",400,240,20,20],[v.p1Wins,"p1Wins",400,240,450,200],[v.p2Wins,"p2Wins",400,240,450,200],[v.aiWins,"aiWins",400,240,450,200],[v.playerWins,"playerWins",400,240,450,200],[v.quit,"quit",400,240,340,165],[v.level,"level",400,240,370,180],[v.tutorial1,"tutorial1",400,240,370,180],[v.tutorial2,"tutorial2",600,320,300,60],[v.tutorial3,"tutorial3",540,400,300,130],[v.tutorial4,"tutorial4",540,300,220,80],[v.tutorial5,"tutorial5",400,400,560,140],[v.tutorial6,"tutorial6",400,240,360,200]];var x;const y={none:-1,next:0,skip:80,soundon:160,soundoff:240,title:320,cancel:400,replay:480,view:560},A=64;var B,C,D,E,F,G,V=2;return{init:H,popup:I,close:J,transform:K,minimize:L,restore:M,push:N,draw:O,checkPassSlot1:Q,checkPassSlot2:R,checkPassSlot3:S}}(),gameLogic=function(){function n(f,g,h){c=f,b=g,a=h,d=c.screenWidth/2,e=c.screenHeight/2,l=0}function o(a,b){i=a,k=b;var c,d,e,n;1==i?(c=11>k?k+4:23>k?k+3:25,d=16>k?6-Math.floor((k-1)/3):1,e=17>k?3-Math.floor((k-1)/8):1,n=13>k?-20+10*(k-1):100):(c=20,d=1,e=1,n=100),ai.setupBoard(c,d,e),ai.setAIability(n),hud.setInfo(i,k),1==k%2?(ui.resetSlideIn(2,1,2,l),j=0):(ui.resetSlideIn(1,2,2,l),j=1),l=0,g=f.animating,h=1==i?f.level:f.selecting,m=-1}function p(){return ui.push(),1==ui.isIdle()&&g==f.animating&&r(h),g==f.leaving?c.mainStates.resetTitle:c.mainStates.unknown}function q(){ui.draw()}function r(a){switch(g=a){case f.reset:o(i,k+1);break;case f.level:dialog.popup("level",k);break;case f.selecting:s(d,e);break;case f.aiSelect:var b;b=ai.aiPick(),ui.resetPaint(Math.floor(b/10),b%10,j),m=-1,ui.setSelect(-1,0),g=f.animating,h=f.switching;break;case f.switching:j=(j+1)%2,ui.resetSwitching(j),g=f.animating,h=0==ai.getUncoloredCount()?f.resulting:1==i&&1==j?f.aiSelect:f.selecting;break;case f.resulting:2==i?1==j?dialog.popup("p1Wins"):dialog.popup("p2Wins"):1==j?dialog.popup("playerWins"):dialog.popup("aiWins")}}function s(a,b){switch(d=a,e=b,g){case f.level:dialog.checkPassSlot2(a,b,0);break;case f.selecting:hud.checkMousePassSound(a,b,j),hud.checkMousePassTitle(a,b,j),0==j?arm1.setTarget(a,b):arm2.setTarget(a,b),m=ui.selection(a,b),ui.setSelect(m,j);break;case f.colorSelect:panel.select(a,b);break;case f.resulting:dialog.checkPassSlot1(a,b,(j+1)%2),dialog.checkPassSlot2(a,b,(j+1)%2),dialog.checkPassSlot3(a,b,(j+1)%2);break;case f.viewing:hud.checkMousePassSound(a,b,(j+1)%2),hud.checkMousePassMinimized(a,b,(j+1)%2);break;case f.quit:dialog.checkPassSlot1(a,b,j),dialog.checkPassSlot2(a,b,j),dialog.checkPassSlot3(a,b,j)}}function t(){var b;switch(g){case f.level:dialog.checkPassSlot2(d,e,0)>=0&&(dialog.close(),g=f.animating,h=1==k%2?f.selecting:f.aiSelect);break;case f.selecting:hud.checkMousePassSound(d,e,j)>=0&&hud.setSoundon((hud.getSoundon()+1)%2),hud.checkMousePassTitle(d,e,j)>=0&&(dialog.popup("quit"),g=f.quit,h=f.selecting),m>=0&&(panel.popup(d,e,m,[0,1,2]),g=f.colorSelect);break;case f.colorSelect:b=panel.select(d,e),-1==b?(panel.close(),g=f.selecting,m=ui.selection(d,e),ui.setSelect(m,j)):b>=0&&(panel.close(),ui.resetPaint(m,b+1,j),m=-1,ui.setSelect(-1,0),g=f.animating,h=f.switching);break;case f.resulting:if(dialog.checkPassSlot1(d,e,j)>=0)dialog.close(),ui.resetSlideOut(2,0,1,0),g=f.animating,h=f.leaving;else if(dialog.checkPassSlot2(d,e,j)>=0)dialog.checkPassSlot2(0,0,0),dialog.minimize(),hud.setMinimized(1),g=f.viewing,h=f.viewing;else if(dialog.checkPassSlot3(d,e,j)>=0){dialog.close();var c,n;1==i&&0==j?(c=k,k--,n=1):(c=k+1,n=0),1==c%3&&0==n?(l=1,ui.resetSlideOut(0,0,0,1)):(l=0,1==c%2?ui.resetSlideOut(2,1,2,0):ui.resetSlideOut(1,2,2,0)),g=f.animating,h=f.reset}break;case f.viewing:hud.checkMousePassSound(d,e,(j+1)%2)>=0&&hud.setSoundon((hud.getSoundon()+1)%2),hud.checkMousePassMinimized(d,e,(j+1)%2)>=0&&(dialog.restore(),hud.setMinimized(0),hud.checkMousePassMinimized(0,0,0),g=f.resulting);break;case f.quit:dialog.checkPassSlot1(d,e,j)>=0?(dialog.close(),ui.resetSlideOut(2,0,1,0),hud.checkMousePassSound(d,e,j),hud.checkMousePassTitle(d,e,j),g=f.animating,h=f.leaving):dialog.checkPassSlot2(d,e,j)>=0?(dialog.close(),hud.checkMousePassSound(0,0,0),hud.checkMousePassTitle(0,0,0),k--,l=0,1==(k+1)%2?ui.resetSlideOut(2,1,2,0):ui.resetSlideOut(1,2,2,0),g=f.animating,h=f.reset):dialog.checkPassSlot3(d,e,j)>=0&&(dialog.close(),g=h)}}var a,b,c,d,e;const f={unknown:-1,reset:0,level:1,animating:2,selecting:3,colorSelect:4,aiSelect:5,switching:6,resulting:7,viewing:8,quit:9,leaving:10};var g,h,i,j,k,l,m;return{init:n,reset:o,push:p,draw:q,eventMouseMove:s,eventMouseClick:t}}(),hud=function(){function u(d,e,f){c=d,b=e,a=f,v()}function v(){k=0,l=2,m=0,n=0,o=-1,p=-1,mousePassMinimized=-1,d=-80,r=-160,i=-1,g=0,h=0}function w(a){if(!(a>2||0>a||a==g)){h=a;var b=h-g;b>0?(f=.1,t=.2):(f=-.1,t=-.2,b=-1*b),i=2==b?59:39,e=0,s=0,j=i}}function x(){0>i||(i>j-20?(e+=f,s+=t):20>i&&(e-=f,s-=t),d+=e,r+=s,i--,0>i&&(g=h))}function y(){switch(a.drawImage(b.hud,0,0,800,79,0,d,800,79),l){case 0:a.drawImage(b.title,0,120,190,40,20,d+7,95,20);break;case 1:a.drawImage(b.title,0,80,190,40,20,d+7,95,20),a.drawImage(b.title,260,120,190,40,490,d+7,95,20),ui.drawNumbers(a,m,560,d+7,.36);break;case 2:a.drawImage(b.title,260,80,216,40,20,d+7,108,20)}0==n?(p>=0&&a.drawImage(b.glow,80*p,0,80,86,745,d-7,40,43),a.drawImage(b.misc,320,0,80,64,745,d+3,40,32)):(mousePassMinimized>=0&&a.drawImage(b.glow,80*mousePassMinimized,0,80,86,745,d-7,40,43),a.drawImage(b.misc,560,0,80,64,745,d+3,40,32)),o>=0&&a.drawImage(b.glow,80*o,0,80,86,760,d+30,40,43),1==k?a.drawImage(b.misc,160,0,80,64,760,d+40,40,32):a.drawImage(b.misc,240,0,80,64,760,d+40,40,32);var e;e=ai.getUncoloredCount()>9?70:36,a.drawImage(b.hud,801,0,152,79,c.screenWidth/2-76,r,152,79),ui.drawNumbers(a,ai.getUncoloredCount(),c.screenWidth/2-e/2,r+3,1)}function z(a,b,c){return p=a>745&&800>=a&&b>d-10&&d+40>=b?c:-1}function A(a,b,c){return mousePassMinimized=a>745&&800>=a&&b>d-10&&d+40>=b?c:-1}function B(a,b,c){return o=a>760&&800>=a&&b>d+40&&d+72>=b?c:-1}function C(a){k=a}function D(){return k}function E(a,b){l=a,m=b}function F(a){n=a}var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,d,e,f,g,h,i,j,r,s,t;return{init:u,reset:v,resetSliding:w,push:x,draw:y,setSoundon:C,getSoundon:D,checkMousePassTitle:z,checkMousePassSound:B,checkMousePassMinimized:A,setInfo:E,setMinimized:F}}(),loader=function(){function d(d,e,f){c=d,b=e,a=f}function e(d){a.fillStyle="#cedfe7",a.fillRect(0,0,c.screenWidth,c.screenHeight),a.textBaseline="bottom",a.fillStyle="#000000",a.font="14px monospace",a.textAlign="center",a.fillText(d+"%",c.screenWidth/2,200);var f,e=Math.floor(d/10);f=30>d?1:60>d?2:3;for(var g=0;10>g;g++)e>g?a.drawImage(b.tiles,400,46*f,40,46,200+40*g,240,40,46):g>e?a.drawImage(b.tiles,0,0,40,46,200+40*g,240,40,46):a.drawImage(b.tiles,40*(d-10*g),46*f,40,46,200+40*g,240,40,46),a.drawImage(b.tileBorder,40,0,40,46,200+40*g,240,40,46),a.drawImage(b.tileBorder,80,0,40,46,200+40*g,240,40,46);a.drawImage(b.tileBorder,0,0,40,46,560,240,40,46)}function n(a){b=a,h=0,i=1,k=0,l=k+c.screenWidth,m=l+c.screenWidth,j=0,f=59,g=f}function o(){switch(j){case 0:f>g-20?h+=i:20>f&&(h-=i),k-=h,l=k+c.screenWidth,m=l+c.screenWidth,f--,0>f&&(j=1,f=9);break;case 1:f--,0>f&&(j=2,f=59);break;case 2:f>g-20?h+=i:20>f&&(h-=i),k-=h,l=k+c.screenWidth,m=l+c.screenWidth,f--,0>f&&(j=3,f=-1)}return 0>f&&3==j?c.mainStates.resetTitile:c.mainStates.unknown}function p(){a.fillStyle="#cedfe7",a.fillRect(0,0,c.screenWidth,c.screenHeight),q(),a.drawImage(b.html5,l+c.screenWidth/2-128,c.screenHeight/2-150),a.drawImage(b.background,m,0)}function q(){a.textBaseline="bottom",a.fillStyle="#000000",a.font="14px monospace",a.textAlign="center",a.fillText("100%",c.screenWidth/2+k,200),color=3;for(var d=0;10>d;d++)a.drawImage(b.tiles,400,138,40,46,200+40*d+k,240,40,46),a.drawImage(b.tileBorder,40,0,40,46,200+40*d+k,240,40,46),a.drawImage(b.tileBorder,80,0,40,46,200+40*d+k,240,40,46);a.drawImage(b.tileBorder,0,0,40,46,560+k,240,40,46)}var a,b,c,f,g,h,i,j,k,l,m;return{init:d,draw:e,resetLogoSliding:n,pushLogoSliding:o,drawLogoSliding:p}}(),panel=function(){function q(d,i,j){c=d,b=i,a=j,g=0,h=-1,o=[0,1,2],k=document.createElement("canvas"),k.width=e,k.height=f,l=k.getContext("2d")}function r(a,b,c,d){o=d.slice(0),0==o[0]&&0==ai.isColorOK(c,1)&&(o[0]=3),1==o[1]&&0==ai.isColorOK(c,2)&&(o[1]=4),2==o[2]&&0==ai.isColorOK(c,3)&&(o[2]=5),p=-1,i=a,j=b-f,h=0,g=1}function s(){g=3,h=d}function t(a,b){return 2!=g?-2:p=a>i&&i+e>a&&b>j&&j+32>=b&&3!=o[0]?0:a>i&&i+e>a&&b>j+32&&j+58>=b&&4!=o[1]?1:a>i&&i+e>a&&b>j+58&&j+f>b&&5!=o[2]?2:-1}function u(){if(!(0>h))switch(g){case 0:break;case 1:h++,h==d&&g++;break;case 2:break;case 3:h--,0>h&&(g=0)}}function v(){if(0!=g){var c,q;l.drawImage(b.panel,0,0),0==p?l.drawImage(b.bottons,m,n*o[0],m,n,10,10,m,n):l.drawImage(b.bottons,0,n*o[0],m,n,10,10,m,n),1==p?l.drawImage(b.bottons,m,n*o[1],m,n,10,35,m,n):l.drawImage(b.bottons,0,n*o[1],m,n,10,35,m,n),2==p?l.drawImage(b.bottons,m,n*o[2],m,n,10,60,m,n):l.drawImage(b.bottons,0,n*o[2],m,n,10,60,m,n),2==g?a.drawImage(k,i,j):(1==g||3==g)&&(c=20*h,q=17.5*h,a.drawImage(k,0,80,10+c,10,i,j+f-10,10+c,10),a.drawImage(k,90,80,10,10,i+10+c,j+f-10,10,10),a.drawImage(k,0,0,10+c,10+q,i,j+f-20-q,10+c,10+q),a.drawImage(k,90,0,10,10+q,i+10+c,j+f-20-q,10,10+q))}}function w(a){p=a}var a,b,c;const d=4,e=100,f=90;var g,h,i,j,k,l;const m=80,n=20;var o,p;return{init:q,popup:r,close:s,push:u,draw:v,select:t,setBottonPress:w}}(),arm1=function(){function B(d,e,f){c=d,b=e.arm1,a=f,C()}function C(){u=-220,r=c.screenWidth/2+u,s=c.screenHeight/2,p=r,q=s,t=0,z=-1,x=0,y=0,F(r,s)}function D(a){if(!(a>2||0>a||a==x)){y=a;var b=y-x;if(b>0?w=.2:(w=-.2,b=-1*b),2==b)z=69;else switch(x){case 0:z=39;break;case 1:z=0>w?39:49;break;case 2:z=49}v=0,A=z}}function E(){if(z>=0&&(z>A-20?v+=w:20>z&&(v-=w),u+=v,p=c.screenWidth/2+u,q=c.screenHeight/2,z--,0>z&&(x=y)),r==p&&s==q)t=0;else{var a=Math.sqrt((p-r)*(p-r)+(q-s)*(q-s));if(o>=a)r=p,s=q;else{var b=H(r,s,p,q);r+=Math.cos(b)*o,s+=Math.sin(b)*o}t=1,F(r,s)}}function F(a,b){d=125+u,e=392;var o=Math.sqrt((a-d)*(a-d)+(b-e)*(b-e));j=d+.3*(a-d),k=e+.3*(b-e)-.2*(c.screenHeight-o),n=H(j,k,a,b),h=j-57*Math.cos(-1.02-n),i=k+57*Math.sin(-1.02-n);var p=H(d,e,h,i),q=125,r=Math.sqrt((h-d)*(h-d)+(i-e)*(i-e)),s=121;l=p-Math.acos((q*q+r*r-s*s)/(2*q*r)),f=d+Math.cos(l)*q,g=e+Math.sin(l)*q,m=H(f,g,h,i)}function G(){a.drawImage(b,165,71,35,15,115+u,398,35,15),a.save(),a.setTransform(1,0,0,1,0,0),a.translate(d,e),a.rotate(l+Math.PI+.12),a.drawImage(b,0,66,150,54,-132,-26,150,54),a.restore(),a.save(),a.setTransform(1,0,0,1,0,0),a.translate(h,i),a.rotate(n),a.drawImage(b,159,0,51,55,-20,0,51,55),a.restore(),a.save(),a.setTransform(1,0,0,1,0,0),a.translate(f,g),a.rotate(m-.22),a.drawImage(b,0,0,158,65,-25,-25,158,65),a.restore(),a.drawImage(b,0,121,171,110,0+u,370,171,110)}function H(a,b,c,d){var e=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)),f=Math.asin((d-b)/e);return a>c&&(f=-1*f+Math.PI),f}function I(a,b){p=a,q=b}function J(){return[j,k]}function K(){return t}function L(){return 0>z?0:1}var a,b,c,d,e,f,g,h,i,j,k,l,m,n;const o=15;var p,q,r,s,t,u,v,w,x,y,z,A;return{init:B,reset:C,resetSliding:D,push:E,draw:G,setTarget:I,getLaserHead:J,isMoving:K,isSliding:L}}(),arm2=function(){function B(d,e,f){c=d,b=e.arm2,a=f,C()}function C(){u=260,r=c.screenWidth/2+u,s=c.screenHeight/2,p=r,q=s,t=0,z=-1,x=0,y=0,F(r,s)}function D(a){if(!(a>2||0>a||a==x)){y=a;var b=y-x;if(b>0?w=-.2:(w=.2,b=-1*b),2==b)z=79;else switch(x){case 0:z=59;break;case 1:z=w>0?59:39;break;case 2:z=39}v=0,A=z}}function E(){if(z>=0&&(z>A-20?v+=w:20>z&&(v-=w),u+=v,p=c.screenWidth/2+u,q=c.screenHeight/2,z--,0>z&&(x=y)),r==p&&s==q)return t=0,void 0;var a=Math.sqrt((p-r)*(p-r)+(q-s)*(q-s));if(o>=a)r=p,s=q;else{var b=H(r,s,p,q);r+=Math.cos(b)*o,s+=Math.sin(b)*o}t=1,F(r,s)}function F(a,b){d=696+u,e=383;var o=Math.sqrt(c.screenWidth*c.screenWidth+c.screenHeight*c.screenHeight),p=Math.sqrt((a-d)*(a-d)+(b-e)*(b-e)),q=.5*(1-p/o)*Math.PI,r=H(d,e,a,b);l=r+q,f=d+117*Math.cos(l+.36),g=e+117*Math.sin(l+.36),m=r-q+Math.PI+(1-p/o),h=f+146*Math.cos(m+3.13),i=g+146*Math.sin(m+3.13),n=H(h,i,a,b)+Math.PI,j=h+23*Math.cos(n+3.15),k=i+23*Math.sin(n+3.15)}function G(){a.drawImage(b,0,130,158,125,c.screenWidth-158+u,c.screenHeight-125,158,125),a.save(),a.setTransform(1,0,0,1,0,0),a.translate(h,i),a.rotate(n),a.drawImage(b,152,95,40,40,-25,-17,40,40),a.restore(),a.save(),a.setTransform(1,0,0,1,0,0),a.translate(f,g),a.rotate(m),a.drawImage(b,0,0,196,50,-160,-20,196,50),a.restore(),a.save(),a.setTransform(1,0,0,1,0,0),a.translate(d,e),a.rotate(l),a.drawImage(b,0,50,150,83,-23,-22,150,83),a.restore()}function H(a,b,c,d){var e=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)),f=Math.asin((d-b)/e);return a>c&&(f=-1*f+Math.PI),f}function I(a,b){p=a,q=b}function J(){return[j,k]}function K(){return t}function L(){return 0>z?0:1}var a,b,c,d,e,f,g,h,i,j,k,l,m,n;const o=15;var p,q,r,s,t,u,v,w,x,y,z,A;return{init:B,reset:C,resetSliding:D,push:E,draw:G,setTarget:I,getLaserHead:J,isMoving:K,isSliding:L}}(),title=function(){function l(f,g,h){c=f,b=g,a=h,d=c.screenWidth/2,e=c.screenHeight/2}function m(){var a=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,-1,-1,-1,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,-1,-1,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,-1,-1,-1,-1,-1,67,67,67,62,62,62,62,62,62,68,68,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,63,63,63,63,63,-1,-1,69,-1,-1,-1,-1,-1,-1,-1,-1,-1,64,63,63,63,63,63,63,65,69,70,70,-1,-1,-1,-1,-1,-1,64,64,63,63,63,63,63,65,65,-1,70,-1,-1,-1,-1,-1,-1,-1,-1,64,66,66,66,66,66,66,65,71,-1,70,-1,-1,-1,-1,-1,-1,-1,66,66,66,66,66,66,66,-1,71,71,72,-1,-1,-1,-1,-1,-1,-1,-1,66,66,66,66,66,66,-1,-1,-1,72,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];ai.presetBoard(12,a,1,1),ai.setColor(1,0),ai.setColor(3,2),ai.setColor(4,1),ai.setColor(7,3),ui.setOverlap(0,"title"),ui.setOverlap(2,"p1Game"),ui.setOverlap(5,"p2Game"),ui.resetSlideIn(2,0,1,0),g=f.animating,h=f.selecting,i=0,j=0}function n(){return ui.push(),1==ui.isIdle()&&g==f.animating&&p(h),g==f.leaving?[c.mainStates.game,i,j]:[c.mainStates.unknown,i,j]}function o(){ui.draw()}function p(a){switch(g=a){case f.quit:ui.resetSlideOut(2,0,1,0),g=f.animating,h=f.leaving;break;case f.leaving:ui.clearOverlap()}}function q(a,b){switch(d=a,e=b,g){case f.selecting:arm1.setTarget(a,b),hud.checkMousePassSound(a,b,0),k=ui.selection(a,b),ui.setSelect(k,0);break;case f.modeSelect:panel.select(a,b)}}function r(){var b;switch(g){case f.selecting:hud.checkMousePassSound(d,e,0)>=0&&hud.setSoundon((hud.getSoundon()+1)%2),2==k?(panel.popup(d,e,k,[7,8,9]),g=f.modeSelect):5==k?(panel.popup(d,e,k,[0,1,6]),g=f.modeSelect):k>=0&&(panel.popup(d,e,k,[0,1,2]),g=f.modeSelect);break;case f.modeSelect:b=panel.select(d,e),-1==b?(panel.close(),g=f.selecting,k=ui.selection(d,e),ui.setSelect(k,0)):b>=0&&(panel.close(),2==k?(ui.resetPaint(k,3,0),i=1,j=0==b?1:1==b?5:9,h=f.quit):5==k?(ui.resetPaint(k,3,0),i=2,j=1,h=f.quit):(ui.resetPaint(k,b+1,0),h=f.selecting),k=-1,ui.setSelect(-1,0),g=f.animating)}}var a,b,c,d,e;const f={unknown:-1,animating:0,selecting:1,modeSelect:2,quit:3,leaving:4};var g,h,i,j,k;return{init:l,reset:m,push:n,draw:o,eventMouseMove:q,eventMouseClick:r}}(),tutorial=function(){function j(f,g,h){c=f,b=g,a=h,d=c.screenWidth/2,e=c.screenHeight/2}function k(){var a=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,62,62,62,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,62,62,62,62,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,61,61,63,63,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,65,64,64,64,63,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,65,64,64,63,63,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,66,66,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];ai.presetBoard(6,a,5,3),ai.setColor(4,2),ai.setColor(5,3),hud.setInfo(0,1),g=f.animating,h=f.dialog1}function l(){return ui.push(),1==ui.isIdle()&&g==f.animating&&n(h),g==f.leaving?c.mainStates.game:c.mainStates.unknown}function m(){ui.draw()
}function n(a){switch(g=a){case f.dialog1:dialog.popup("tutorial1");break;case f.dialog2:dialog.popup("tutorial2",0),ui.setFocusTargets([3]);break;case f.dialog3:dialog.transform("tutorial3",0),ui.setFocusTargets([4,5,3]);break;case f.switchToAI:ui.resetSwitching(1),g=f.animating,h=f.aiPaint;break;case f.aiPaint:ui.resetPaint(1,3,1),g=f.animating,h=f.switchBack;break;case f.switchBack:ui.resetSwitching(0),g=f.animating,h=f.dialog4;break;case f.dialog4:dialog.popup("tutorial4"),ui.setFocusTargets([0]);break;case f.selectColor:ui.setFocusTargets([1,3,0]);break;case f.switchToAI2:ui.resetSwitching(1),g=f.animating,h=f.dialog5;break;case f.dialog5:dialog.popup("tutorial5"),ui.setFocusTargets([2]),ui.setSelect(2,0);break;case f.dialog6:dialog.transform("tutorial6"),ui.setFocusTargets([]);break;case f.leaving:}}function o(a,b){switch(d=a,e=b,g){case f.dialog1:dialog.checkPassSlot1(a,b,0),dialog.checkPassSlot3(a,b,0);break;case f.dialog2:arm1.setTarget(a,b),i=ui.selection(a,b),3==i?ui.setSelect(i,0):(ui.setSelect(-1,0),i=-1);break;case f.dialog3:panel.select(a,b);break;case f.dialog4:arm1.setTarget(a,b),i=ui.selection(a,b),0==i?ui.setSelect(i,0):(ui.setSelect(-1,0),i=-1);break;case f.selectColor:panel.select(a,b);break;case f.dialog5:dialog.checkPassSlot2(a,b,0);break;case f.dialog6:dialog.checkPassSlot1(a,b,0),dialog.checkPassSlot3(a,b,0)}}function p(){switch(g){case f.dialog1:dialog.checkPassSlot1(d,e,0)>=0&&(dialog.close(),g=f.animating,h=f.leaving),dialog.checkPassSlot3(d,e,0)>=0&&(dialog.close(),ui.resetSlideIn(2,1,2,0),g=f.animating,h=f.dialog2);break;case f.dialog2:3==i&&(panel.popup(d,e,i,[0,1,2]),g=f.animating,h=f.dialog3);break;case f.dialog3:res=panel.select(d,e),-1==res?(panel.close(),g=f.animating,h=f.dialog2):res>=0&&(panel.close(),dialog.close(),ui.resetPaint(i,res+1,0),i=-1,ui.setSelect(-1,0),g=f.animating,h=f.switchToAI);break;case f.dialog4:0==i&&(panel.popup(d,e,i,[0,1,2]),g=f.animating,h=f.selectColor);break;case f.selectColor:res=panel.select(d,e),-1==res?(panel.close(),ui.setFocusTargets([0]),g=f.dialog4,o(d,e)):res>=0&&(panel.close(),dialog.close(),ui.resetPaint(i,res+1,0),i=-1,ui.setSelect(-1,0),g=f.animating,h=f.switchToAI2);break;case f.dialog5:dialog.checkPassSlot2(d,e,0)>=0&&(ui.setSelect(-1,0),g=f.animating,h=f.dialog6);break;case f.dialog6:dialog.checkPassSlot1(d,e,0)>=0&&(dialog.close(),ui.resetSlideOut(2,1,1,0),k(),g=f.animating,h=f.dialog1),dialog.checkPassSlot3(d,e,0)>=0&&(dialog.close(),ui.resetSlideOut(2,1,1,0),g=f.animating,h=f.leaving)}}var a,b,c,d,e;const f={unknown:-1,animating:0,dialog1:1,dialog2:2,dialog3:3,switchToAI:4,aiPaint:5,switchBack:6,dialog4:7,selectColor:8,switchToAI2:9,dialog5:10,dialog6:11,leaving:12};var g,h,i;return{init:j,reset:k,push:l,draw:m,eventMouseMove:o,eventMouseClick:p}}(),ui=function(){function g(d,e,f){c=d,b=e,a=f;for(var g=0;q>g;g++)x[g]=document.createElement("canvas");p=0,H=-1,U(),rb()}function h(){warp.pushFade(),1==warp.isWarping()?(warp.pushWarp(),0==warp.isWarping()&&(e=d.idle)):O(),panel.push(),hud.push(),dialog.push();var a,b=1;if(e==d.paint){for(M(),lb(),a=0;D.length>a;a++)if(-1!=D[a]){b=0;break}1==b&&(e=d.idle,H=-1)}else arm1.push(),arm2.push();e==d.switching&&0==arm1.isSliding()&&0==arm2.isSliding()&&(e=d.idle)}function i(){a.drawImage(b.backgrounds[G],0,0),1==warp.isWarping()?warp.drawWarp():(P(),hud.draw()),arm2.draw(),sb(),arm1.draw(),warp.drawFade(),panel.draw(),mb(),tb()}function I(a,b,c,g){l=ai.getMaxCol(),m=ai.getMaxRow(),n=ai.getGraphSize(),arm1.resetSliding(a),arm2.resetSliding(b),hud.resetSliding(c),N(),1==g&&warp.resetFade(0),wb(-1,0),e=d.slideIn,f=d.idle,w=1}function J(a,b,g,h){var i,j=Math.ceil(1.2*c.screenWidth/u)*u;for(i=0;n>i;i++)z[i]=0==i%2?A[i]-j:A[i]+j;1==h?(arm1.resetSliding(0),arm2.resetSliding(0),warp.resetFade(1),f=d.warp):(arm1.resetSliding(a),arm2.resetSliding(b),f=d.idle),hud.resetSliding(g),wb(-1,0),e=d.slideOut,w=4}function K(a,b,c){if(-1!=a){ai.setColor(a,b);var f=L(a);kb(a,f[1],f[2],f[3],f[4],c,b,f[0]);var g,h=ai.getBlackout();for(g=0;h.length>g;g++)ai.setColor(h[g],0),L(h[g]);wb(-1,0),e=d.paint,H=0}}function L(a){const b=3;var l,m,n,o,p,q,r,s,c=ai.getSubGraph(a),d=ai.getBorder(a),e=Math.floor(d[1])-Math.floor(d[3])+1,f=d[2]-d[0]+1,g=d[0],h=d[3],i=h-Math.floor(h)>0?1:0;for(E[a].length=0,s=0,p=-1,r=0;e*f>r;r++)" "==c[r]?E[a].push(F):(E[a].push(-3*s),s++,q=r,0>p&&(p=r));return offset=1==i?0==g%2?-20:0:1==g%2?20:0,l=p*j+20+offset+v,m=43,offset=1==i?0==(g+f-1)%2?-20:0:1==(g+f-1)%2?20:0,n=q%e*j+20+offset+v,o=.75*f*k+v,D[a]=0,[b*s+10,l,m,n,o]}function M(){if(1==H){var a,b,c,d,e,f;for(f=0;D.length>f;f++)if(-1!=D[f]){for(a=-1,b=ai.getBorder(f),c=Math.floor(b[1])-Math.floor(b[3])+1,d=b[2]-b[0]+1,e=0;c*d>e;e++)E[f][e]!=F&&(E[f][e]++,10>=E[f][e]&&(a=0));D[f]=a}}}function N(){var a,e,f=Math.ceil(1.2*c.screenWidth/u)*u;for(y.length=0,z.length=0,A.length=0,B.length=0,C.length=0,D.length=0,E.length=0,a=0;n>a;a++)e=ai.getBorder(a),x[a].width=(e[1]-e[3]+1)*j+40,x[a].height=.75*(e[2]-e[0])*k+k+40,y.push(x[a].getContext("2d")),z.push(r+e[3]*j),1==a%2?A.push(z[a]-f):A.push(z[a]+f),B.push(s+.75*e[0]*k),C.push(.02*(n-a-1)),D.push(-1),E[a]=Array(),Q(a,0)}function O(){var a,b;switch(w){case 0:break;case 1:for(b=n,a=0;n>a;a++)A[a]<z[a]?A[a]+=u:A[a]>z[a]?A[a]-=u:b--;0==b&&(w=2);break;case 2:for(b=n,a=0;n>a;a++)C[a]>0?C[a]-=.01:b--;0==b&&(e=d.idle,w=3);break;case 3:break;case 4:for(b=n,a=0;n>a;a++).02*(n-a-1)>C[a]?C[a]+=.01:b--;0==b&&(w=5);break;case 5:for(b=n,a=0;n>a;a++)A[a]<z[a]?A[a]+=u:A[a]>z[a]?A[a]-=u:b--;f==d.warp&&0==warp.isFading()?(arm1.reset(),arm2.reset(),warp.resetWarp(),G=(G+1)%5,e=d.warp,f=d.idle,w=0):0==b&&(e=d.idle,f=d.idle,w=0)}}function P(){ai.getBoard();var e,f,g,h,i;for(e=0;n>e;e++)C[e]>0?(f=(A[e]-c.screenWidth/2)*(1-C[e])+c.screenWidth/2,g=(B[e]-c.screenHeight/2)*(1-C[e])+c.screenHeight/2,h=x[e].width*C[e],i=x[e].height*C[e],a.drawImage(x[e],f,g,x[e].width-h,x[e].height-i),1==p&&a.drawImage(b.shadow,f,300+130*(1-C[e]),x[e].width-h,50*(1-C[e]))):(o!=e&&a.drawImage(x[e],A[e],B[e]),-1!=D[e]&&Q(e,0),1==p&&a.drawImage(b.shadow,A[e],430,x[e].width,50));o>=0&&(0==w||3==w)&&a.drawImage(x[o],A[o],B[o])}function Q(a,c){if(!(0>a)){var d=ai.getBorder(a),e=Math.floor(d[1])-Math.floor(d[3])+1,f=d[2]-d[0]+1,g=d[0],h=d[3],i=h-Math.floor(h)>0?1:0,l=ai.getSubGraph(a);y[a].clearRect(0,0,x[a].width,x[a].height);var m,n,o,p,q,r;if(0!=c)for(m=0;f>m;m++)for(o=m*e,p=1==i?0==(g+m)%2?-20:0:1==(g+m)%2?20:0,n=0;e>n;n++)" "!=l[o+n]&&(q=n*j+p,r=.75*m*k,y[a].drawImage(b.glow,80*(c-1),0,80,86,q,r,80,86));var t,u,s=ai.getColor(a);for(m=0;f>m;m++)for(o=m*e,p=1==i?0==(g+m)%2?-20:0:1==(g+m)%2?20:0,n=0;e>n;n++)" "!=l[o+n]&&(u=o+n,q=v+n*j+p,r=v+.75*m*k,-1!=D[a]?0>=E[a][u]?y[a].drawImage(b.tiles,0,0,j,k,q,r,j,k):E[a][u]>0&&10>=E[a][u]?y[a].drawImage(b.tiles,j*E[a][u],k*s,j,k,q,r,j,k):y[a].drawImage(b.tiles,400,k*s,j,k,q,r,j,k):-1!=s?y[a].drawImage(b.tiles,400,k*s,j,k,q,r,j,k):y[a].drawImage(b.tiles,0,0,j,k,q,r,j,k),t=R(l,o+n,e,f,g),1==t[0]&&y[a].drawImage(b.tileBorder,0,0,j,k,q,r,j,k),1==t[1]&&y[a].drawImage(b.tileBorder,j,0,j,k,q,r,j,k),1==t[2]&&y[a].drawImage(b.tileBorder,80,0,j,k,q,r,j,k));X(a)}}function R(a,b,c,d,e){var f=[1,1,1];if(" "==a[b])return f;var i,g=b%c,h=Math.floor(b/c);return g==c-1||" "==a[b+1]||(f[0]=0),i=1==(e+h)%2?b+c+1:b+c,h==d-1||1==(e+h)%2&&g==c-1||" "==a[i]||(f[1]=0),i=1==(e+h)%2?b+c:b+c-1,h==d-1||0==(e+h)%2&&0==g||" "==a[i]||(f[2]=0),f}function S(a,b){var e,c=-1,d=-1;for(e=0;l>e;e+=.5)if(a>=40+j*e&&40+j*(e+.5)>a){c=e;break}for(e=0;m>e;e++)if(b>=40+.75*k*e&&40+.75*k*(e+1)>b){d=e;break}if(-1==c||-1==d||0==d)return-1;var g,h,i,n,f=c>Math.floor(c)?1:0;i=40+.75*d*k+23,n=40+.75*(d-1)*k+23,0==d%2&&0==f||1==d%2&&1==f?(h=40+c*j,g=h+20):(g=40+c*j,h=g+20);var o,p,q;o=(a-g)*(a-g)+(b-i)*(b-i),p=(a-h)*(a-h)+(b-n)*(b-n),p>o?(q=d*l,q+=1==d%2?Math.floor(c-.5):Math.floor(c)):(q=(d-1)*l,q+=1==d%2?Math.floor(c):Math.floor(c-.5));var t=ai.findGroup(q);return-1==t?-1:-1!=ai.getColor(t)?-1*t-1:t}function U(){W()}function V(a,b){T[a]=b}function W(){for(var a=0;q>a;a++)T[a]=""}function X(a){if(!(0>a||a>=q)){var c=x[a].width/2,d=x[a].height/2;"title"==T[a]?y[a].drawImage(b.title,0,0,520,80,c-260,d-45,520,80):"p1Game"==T[a]?y[a].drawImage(b.title,0,80,190,37,c-95,d-20,190,37):"p2Game"==T[a]&&y[a].drawImage(b.title,260,80,216,37,c-108,d-20,216,37)}}function kb(a,b,c,d,e,f,g,h){gb=-1*a-1,hb=f,ib=g-1,cb=A[a]+b,db=B[a]+c,eb=A[a]+d,fb=B[a]+e,ab=cb,bb=db,jb=0,Y=0,Z=h,0==f?arm1.setTarget(cb,db):arm2.setTarget(cb,db)}function lb(){if(1!=H)return 0==hb?(arm1.push(),0==arm1.isMoving()&&(H=1)):(arm2.push(),0==arm2.isMoving()&&(H=1)),void 0;if(Y++,!(Y>Z)){var a=Y/Z;ab=cb+(eb-cb)*a,bb=db+(fb-db)*a,0==hb?(arm1.setTarget(ab,bb),arm1.push()):(arm2.setTarget(ab,bb),arm2.push()),jb+=Math.floor(7*Math.random()),jb%=7}}function mb(){if(1==H&&!(Y>Z)&&S(ab,bb)==gb){var c;0==hb?(c=arm1.getLaserHead(),$=c[0],_=c[1]):(c=arm2.getLaserHead(),$=c[0],_=c[1]);var d=Math.sqrt((ab-$)*(ab-$)+(bb-_)*(bb-_)),e=nb($,_,ab,bb);a.save(),a.setTransform(1,0,0,1,0,0),a.translate($,_),a.rotate(e),a.drawImage(b.beams,0,40*ib,d,40,0,-20,d,40),a.drawImage(b.sparks,128*jb,0,128,128,d-64,-64,128,128),a.restore()}}function nb(a,b,c,d){var e=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)),f=Math.asin((d-b)/e);return a>c&&(f=-1*f+Math.PI),f}function rb(){ob=0,pb=0,qb.length=0}function sb(){if(1==ob){a.fillStyle="rgba(64, 64, 64, "+pb+")",a.fillRect(0,0,c.screenWidth,c.screenHeight);for(var b=0;qb.length>b;b++)t=qb[b],a.drawImage(x[t],A[t],B[t])}}function tb(){2==ob&&(a.fillStyle="rgba(64, 64, 64, "+pb+")",a.fillRect(0,0,c.screenWidth,c.screenHeight)),dialog.draw()}function ub(a){0==a%2?(arm1.resetSliding(2),arm2.resetSliding(1)):(arm1.resetSliding(1),arm2.resetSliding(2)),e=d.switching}function vb(a,c,d,e,f){const g=35,h=54;for(var j,i=""+c,k=0;i.length>k;k++)j=Number(i[k]),a.drawImage(b.numbers,j*g,0,g,h,d+k*g*f,e,g*f,h*f)}function wb(a,b){a!=o&&(0>a&&o>=0?Q(o,0):a>=0&&0>o?Q(a,b+1):(Q(o,0),Q(a,b+1)),o=a)}function xb(){return e!=d.idle?0:1}function yb(a){p=a}function zb(a,b){ob=b>0?a:0,pb=b}function Ab(a){qb=a.slice(0)}var a,b,c;const d={idle:0,slideIn:1,slideOut:2,paint:3,switching:4,warp:5};var e=d.idle,f=d.idle;const j=40,k=46;var l,m,n,p,o=-1;const q=25,r=20,s=20,u=13,v=20;var w,x=Array(q),y=Array(),z=Array(),A=Array(),B=Array(),C=Array(),D=Array(),E=Array();const F=-99999;var H,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,ob,pb,G=0,T=Array(q),qb=Array();return{init:g,resetSlideIn:I,resetSlideOut:J,resetPaint:K,push:h,draw:i,selection:S,setSelect:wb,setOverlap:V,clearOverlap:W,resetSwitching:ub,isIdle:xb,setShadow:yb,setFocus:zb,setFocusTargets:Ab,drawNumbers:vb}}(),warp=function(){function g(g,i,j){c=g,b=i,a=j,e=c.screenWidth+50,f=c.screenHeight+50,Y=document.createElement("canvas"),Y.width=e,Y.height=f,Z=Y.getContext("2d"),h()}function h(){k=-1,p=-1}function l(a){1==a?(j=0,i=0):(j=1,i=2),k=0}function m(){if(!(0>k))switch(i){case 0:j+=.1,j>1&&(j=1,k=30,i=1);break;case 1:k--;break;case 2:j-=.01,0>j&&(j=0,k=-1)}}function n(){0>k||(a.fillStyle="rgba(255, 255, 255, "+j+")",a.fillRect(0,0,c.screenWidth,c.screenHeight))}function G(){r++,r%=3,J();var a;switch(r){case 0:for(a=0;20>a;a++)K(2*Math.random()*Math.PI,14*Math.random()+6);break;case 1:for(a=0;24>a;a++)K(.26*a,14);break;case 2:}N(),$(),l(0),Q(),p=0}function H(){if(p>=o&&(p=-1),!(0>p)){p++,210==p&&l(1);var a;for(a=0;q>a;a++)M(a);switch(r){case 0:break;case 1:if(0==p%25)for(a=0;24>a;a++)K(.26*a,14);break;case 2:0==p%2&&(K(.31*s,14),K(.31*s+Math.PI,14),s++)}for(a=0;A>a;a++)P(a);_()}}function I(){switch(Z.fillStyle="#000000",Z.fillRect(0,0,e,f),haloFrame){case 0:Z.drawImage(b.halo,0,0,512,512,(e-512)/2-V,(f-512)/2-W,512,512);break;case 1:Z.drawImage(b.halo,512,0,512,512,(e-512)/2-V,(f-512)/2-W,512,512);break;case 2:Z.drawImage(b.halo,0,512,512,512,(e-512)/2-V,(f-512)/2-W,512,512);break;case 3:Z.drawImage(b.halo,512,512,512,512,(e-512)/2-V,(f-512)/2-W,512,512)}var c;for(c=0;A>c;c++)F[c]>=0&&Z.drawImage(b.dot,D[c],E[c]);var d;for(c=0;q>c;c++)x[c]>=0&&(Z.save(),Z.setTransform(1,0,0,1,0,0),Z.translate(v[c],w[c]),Z.rotate(y[c]),d=z[c]*z[c]/600,Z.drawImage(b.warpLine,0,0,203*x[c]*d/100,9*x[c]*d/100),Z.restore());a.drawImage(Y,-25+V,-25+W)}function J(){var a;for(a=0;q>a;a++)t[a]=-1,u[a]=-1,v[a]=-1,w[a]=-1,x[a]=-1,y[a]=-1,z[a]=-1;s=0}function K(a,b){var g=L();0>g||(y[g]=a,x[g]=1,z[g]=b,t[g]=Math.cos(a),u[g]=Math.sin(a),v[g]=e/2,w[g]=f/2)}function L(){var a;for(a=0;q>a;a++)if(0>x[a])return a;return-1}function M(a){if(!(0>x[a])){z[a]+=.5,x[a]+=z[a],v[a]=t[a]*x[a]+e/2,w[a]=u[a]*x[a]+f/2;var b=v[a],c=w[a];(0>b||b>e||0>c||c>f)&&(x[a]=-1,0==r&&K(2*Math.random()*Math.PI,14*Math.random()+6))}}function N(){var a,b,c,d;for(a=0;A>a;a++)c=Math.random()*e,d=Math.random()*f,b=Math.sqrt(c*c+d*d),B[a]=(c-e/2)/b,C[a]=(d-f/2)/b,D[a]=c,E[a]=d,F[a]=8*Math.random()+2}function O(a,b){F[a]=8*Math.random()+2,B[a]=Math.cos(b),C[a]=Math.sin(b),D[a]=5*B[a]*F[a]+e/2,E[a]=5*C[a]*F[a]+f/2}function P(a){if(!(0>F[a])){D[a]+=B[a]*F[a],E[a]+=C[a]*F[a];var b=D[a],c=E[a];(0>b||b>e||0>c||c>f)&&O(a,2*Math.random()*Math.PI)}}function Q(){haloFrame=Math.floor(4*Math.random())}function $(){R=Math.random()+.01,S=Math.random()+.01,T=4*Math.random()+1,U=4*Math.random()+1,V=0,W=0,X=0}function _(){if(!(0>X)){X+=1;var a=p/o;V=T*a*Math.cos(X/R),W=U*a*Math.cos(X/S)}}function ab(){return 0>k?0:1}function bb(){return 0>p?0:1}var a,b,c;var e,f,i,j,k;const o=250;var p;const q=144;var s,r=2,t=Array(q),u=Array(q),v=Array(q),w=Array(q),x=Array(q),y=Array(q),z=Array(q);const A=80;var R,S,T,U,V,W,X,Y,Z,B=Array(A),C=Array(A),D=Array(A),E=Array(A),F=Array(A);return{init:g,resetFade:l,pushFade:m,drawFade:n,isFading:ab,resetWarp:G,pushWarp:H,drawWarp:I,isWarping:bb}}();